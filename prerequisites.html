<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.16">
<title data-rh="true">Prerequisites for TiDB in Kubernetes | TiDB in Kubernetes Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ran-huang.github.io/docusaurus-operator/prerequisites"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Prerequisites for TiDB in Kubernetes | TiDB in Kubernetes Docs"><meta data-rh="true" name="description" content="This document introduces the hardware and software prerequisites for deploying a TiDB cluster in Kubernetes."><meta data-rh="true" property="og:description" content="This document introduces the hardware and software prerequisites for deploying a TiDB cluster in Kubernetes."><link data-rh="true" rel="icon" href="/docusaurus-operator/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ran-huang.github.io/docusaurus-operator/prerequisites"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/docusaurus-operator/prerequisites" hreflang="en"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/docusaurus-operator/prerequisites" hreflang="x-default"><link rel="stylesheet" href="/docusaurus-operator/assets/css/styles.824ca44c.css">
<link rel="preload" href="/docusaurus-operator/assets/js/runtime~main.7b6c7d1a.js" as="script">
<link rel="preload" href="/docusaurus-operator/assets/js/main.81ad91ac.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docusaurus-operator/"><div class="navbar__logo"><img src="/docusaurus-operator/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/docusaurus-operator/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">TiDB in Kubernetes</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docusaurus-operator/">Docs</a><a class="navbar__item navbar__link" href="/docusaurus-operator/architecture">Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ran-huang/docusaurus-operator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docusaurus-operator/">TiDB in Kubernetes</a><button aria-label="Toggle the collapsible sidebar category &#x27;TiDB in Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/get-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docusaurus-operator/prerequisites">Deploy</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docusaurus-operator/prerequisites">In Self-Managed Kubernetes</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docusaurus-operator/prerequisites">Prerequisites for TiDB in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/configure-storage-class">Persistent Storage Class Configuration in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-tidb-operator">Deploy TiDB Operator in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/configure-a-tidb-cluster">Configure a TiDB Cluster in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-on-general-kubernetes">Deploy TiDB in General Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/initialize-a-cluster">Initialize a TiDB Cluster in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/access-tidb">Access the TiDB Cluster in Kubernetes</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docusaurus-operator/deploy-on-aws-eks">In Public Cloud Kubernetes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-cluster-on-arm64">On ARM64</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-tiflash">HTAP</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docusaurus-operator/build-multi-aws-eks">Across Multiple Kubernetes Clusters</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-heterogeneous-tidb-cluster">Heterogeneous Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-tidb-enterprise-edition">Enterprise Edition</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-ticdc">TiCDC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-tidb-binlog">TiDB Binlog</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/restore-data-using-tidb-lightning">Migrate</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/enable-tls-for-mysql-client">Manage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/tips">Troubleshoot</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/faq">TiDB FAQs in Kubernetes</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Deploy</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">In Self-Managed Kubernetes</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docusaurus-operator/prerequisites">Prerequisites for TiDB in Kubernetes</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Prerequisites for TiDB in Kubernetes</h1><p>This document introduces the hardware and software prerequisites for deploying a TiDB cluster in Kubernetes.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="software-version">Software version<a class="hash-link" href="#software-version" title="Direct link to heading">â€‹</a></h2><table><thead><tr><th align="left">Software Name</th><th align="left">Version</th></tr></thead><tbody><tr><td align="left">Docker</td><td align="left">Docker CE 18.09.6</td></tr><tr><td align="left">Kubernetes</td><td align="left">v1.12.5+</td></tr><tr><td align="left">CentOS</td><td align="left">7.6 and kernel 3.10.0-957 or later</td></tr><tr><td align="left">Helm</td><td align="left">v3.0.0+</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="configure-the-firewall">Configure the firewall<a class="hash-link" href="#configure-the-firewall" title="Direct link to heading">â€‹</a></h2><p>It is recommended that you disable the firewall.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop firewalld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl disable firewalld</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If you cannot stop the firewalld service, to ensure the normal operation of Kubernetes, take the following steps:</p><ol><li><p>Enable the following ports on the master, and then restart the service:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">6443</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2379</span><span class="token plain">-2380/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10250</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10251</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10252</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10255</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8472</span><span class="token plain">/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --add-masquerade --permanent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Set it when you need to expose NodePort on the master node.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">30000</span><span class="token plain">-32767/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart firewalld</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Enable the following ports on the nodes, and then restart the service:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10250</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">10255</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8472</span><span class="token plain">/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --add-port</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">30000</span><span class="token plain">-32767/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --add-masquerade --permanent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart firewalld</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="configure-iptables">Configure Iptables<a class="hash-link" href="#configure-iptables" title="Direct link to heading">â€‹</a></h2><p>The FORWARD chain is configured to <code>ACCEPT</code> by default and is set in the startup script:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -P FORWARD ACCEPT</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="disable-selinux">Disable SELinux<a class="hash-link" href="#disable-selinux" title="Direct link to heading">â€‹</a></h2><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">setenforce </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27;</span><span class="token plain"> /etc/selinux/config</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="disable-swap">Disable swap<a class="hash-link" href="#disable-swap" title="Direct link to heading">â€‹</a></h2><p>To make kubelet work, you need to turn off swap and comment out the swap-related line in the <code>/etc/fstab</code> file.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">swapoff -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> -i </span><span class="token string" style="color:#e3116c">&#x27;s/^\(.*swap.*\)$/#\1/&#x27;</span><span class="token plain"> /etc/fstab</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="configure-kernel-parameters">Configure kernel parameters<a class="hash-link" href="#configure-kernel-parameters" title="Direct link to heading">â€‹</a></h2><p>Configure the kernel parameters as follows. You can also adjust them according to your environment:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">modprobe br_netfilter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;</span><span class="token string bash punctuation" style="color:#393A34">  /etc/sysctl.d/k8s.conf</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.bridge.bridge-nf-call-ip6tables = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.bridge.bridge-nf-call-iptables = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.bridge.bridge-nf-call-arptables = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.core.somaxconn = 32768</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">vm.swappiness = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.tcp_syncookies = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.ip_forward = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">fs.file-max = 1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">fs.inotify.max_user_watches = 1048576</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">fs.inotify.max_user_instances = 1024</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.conf.all.rp_filter = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.neigh.default.gc_thresh1 = 80000</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.neigh.default.gc_thresh2 = 90000</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.neigh.default.gc_thresh3 = 100000</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sysctl --system</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="configure-the-irqbalance-service">Configure the Irqbalance service<a class="hash-link" href="#configure-the-irqbalance-service" title="Direct link to heading">â€‹</a></h2><p>The <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/performance_tuning_guide/sect-red_hat_enterprise_linux-performance_tuning_guide-tool_reference-irqbalance" target="_blank" rel="noopener noreferrer">Irqbalance</a> service binds the interrupts of each equipment to different CPUs respectively. This avoids the performance bottleneck when all interrupt requests are sent to the same CPU.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> irqbalance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start irqbalance</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="configure-the-cpufreq-governor-mode">Configure the CPUfreq governor mode<a class="hash-link" href="#configure-the-cpufreq-governor-mode" title="Direct link to heading">â€‹</a></h2><p>To make full use of CPU performance, set the CPUfreq governor mode to <code>performance</code>. For details, see <a href="https://docs.pingcap.com/tidb/v4.0/online-deployment-using-ansible#step-7-configure-the-cpufreq-governor-mode-on-the-target-machine" target="_blank" rel="noopener noreferrer">Configure the CPUfreq governor mode on the target machine</a>.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">cpupower frequency-set --governor performance</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="configure-ulimit">Configure <code>ulimit</code><a class="hash-link" href="#configure-ulimit" title="Direct link to heading">â€‹</a></h2><p>The TiDB cluster uses many file descriptors by default. The <code>ulimit</code> of the worker node must be greater than or equal to <code>1048576</code>.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">&gt;&gt;</span><span class="token string bash punctuation" style="color:#393A34">  /etc/security/limits.conf</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">root        soft        nofile        1048576</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">root        hard        nofile        1048576</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">root        soft        stack         10240</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sysctl --system</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="docker-service">Docker service<a class="hash-link" href="#docker-service" title="Direct link to heading">â€‹</a></h2><p>It is recommended to install Docker CE 18.09.6 or later versions. See <a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener noreferrer">Install Docker</a> for details.</p><p>After the installation, take the following steps:</p><ol><li><p>Save the Docker data to a separate disk. The data mainly contains images and the container logs. To implement this, set the <a href="https://docs.docker.com/config/daemon/systemd/#runtime-directory-and-storage-driver" target="_blank" rel="noopener noreferrer"><code>--data-root</code></a> parameter:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/docker/daemon.json </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  &quot;log-driver&quot;: &quot;json-file&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  &quot;log-opts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;max-size&quot;: &quot;100m&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  &quot;storage-driver&quot;: &quot;overlay2&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  &quot;storage-opts&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    &quot;overlay2.override_kernel_check=true&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  &quot;data-root&quot;: &quot;/data1/docker&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The above command sets the data directory of Docker to <code>/data1/docker</code>.</p></li><li><p>Set <code>ulimit</code> for the Docker daemon:</p><ol><li><p>Create the systemd drop-in directory for the docker service:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p /etc/systemd/system/docker.service.d</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Create a file named as <code>/etc/systemd/system/docker.service.d/limit-nofile.conf</code>, and configure the value of the  <code>LimitNOFILE</code> parameter. The value must be a number equal to or greater than <code>1048576</code>.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/systemd/system/docker.service.d/limit-nofile.conf </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">LimitNOFILE=1048576</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p><strong>Note:</strong></p><p>DO NOT set the value of <code>LimitNOFILE</code> to <code>infinity</code>. Due to <a href="https://github.com/systemd/systemd/commit/6385cb31ef443be3e0d6da5ea62a267a49174688#diff-108b33cf1bd0765d116dd401376ca356L1186" target="_blank" rel="noopener noreferrer">a bug of <code>systemd</code></a>, the <code>infinity</code> value of <code>systemd</code> in some versions is <code>65536</code>.</p></blockquote></li><li><p>Reload the configuration.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> systemctl restart </span><span class="token function" style="color:#d73a49">docker</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="kubernetes-service">Kubernetes service<a class="hash-link" href="#kubernetes-service" title="Direct link to heading">â€‹</a></h2><p>To deploy a multi-master, highly available cluster, see <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/high-availability/" target="_blank" rel="noopener noreferrer">Kubernetes documentation</a>.</p><p>The configuration of the Kubernetes master depends on the number of nodes. More nodes consumes more resources. You can adjust the number of nodes as needed.</p><table><thead><tr><th align="left">Nodes in a Kubernetes cluster</th><th align="left">Kubernetes master configuration</th></tr></thead><tbody><tr><td align="left">1-5</td><td align="left">1vCPUs 4GB Memory</td></tr><tr><td align="left">6-10</td><td align="left">2vCPUs 8GB Memory</td></tr><tr><td align="left">11-100</td><td align="left">4vCPUs 16GB Memory</td></tr><tr><td align="left">101-250</td><td align="left">8vCPUs 32GB Memory</td></tr><tr><td align="left">251-500</td><td align="left">16vCPUs 64GB Memory</td></tr><tr><td align="left">501-5000</td><td align="left">32vCPUs 128GB Memory</td></tr></tbody></table><p>After Kubelet is installed, take the following steps:</p><ol><li><p>Save the Kubelet data to a separate disk (it can share the same disk with Docker). The data mainly contains the data used by <a href="https://kubernetes.io/docs/concepts/storage/volumes/#emptydir" target="_blank" rel="noopener noreferrer">emptyDir</a>. To implement this, set the <code>--root-dir</code> parameter:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;KUBELET_EXTRA_ARGS=--root-dir=/data1/kubelet&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /etc/sysconfig/kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart kubelet</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The above command sets the data directory of Kubelet to <code>/data1/kubelet</code>.</p></li><li><p><a href="https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/" target="_blank" rel="noopener noreferrer">Reserve compute resources</a> by using Kubelet, to ensure that the system process of the machine and the kernel process of Kubernetes have enough resources for operation in heavy workloads. This maintains the stability of the entire system.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="tidb-clusters-requirements-for-resources">TiDB cluster&#x27;s requirements for resources<a class="hash-link" href="#tidb-clusters-requirements-for-resources" title="Direct link to heading">â€‹</a></h2><p>To determine the machine configuration, see <a href="https://docs.pingcap.com/tidb/v4.0/hardware-and-software-requirements#production-environment" target="_blank" rel="noopener noreferrer">Server recommendations</a>.</p><p>In a production environment, avoid deploying TiDB instances on a kubernetes master, or deploy as few TiDB instances as possible. Due to the NIC bandwidth, if the NIC of the master node works at full capacity, the heartbeat report between the worker node and the master node will be affected and might lead to serious problems.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/prerequisites.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docusaurus-operator/get-started"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Get Started With TiDB Operator in Kubernetes</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docusaurus-operator/configure-storage-class"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Persistent Storage Class Configuration in Kubernetes</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#software-version" class="table-of-contents__link toc-highlight">Software version</a></li><li><a href="#configure-the-firewall" class="table-of-contents__link toc-highlight">Configure the firewall</a></li><li><a href="#configure-iptables" class="table-of-contents__link toc-highlight">Configure Iptables</a></li><li><a href="#disable-selinux" class="table-of-contents__link toc-highlight">Disable SELinux</a></li><li><a href="#disable-swap" class="table-of-contents__link toc-highlight">Disable swap</a></li><li><a href="#configure-kernel-parameters" class="table-of-contents__link toc-highlight">Configure kernel parameters</a></li><li><a href="#configure-the-irqbalance-service" class="table-of-contents__link toc-highlight">Configure the Irqbalance service</a></li><li><a href="#configure-the-cpufreq-governor-mode" class="table-of-contents__link toc-highlight">Configure the CPUfreq governor mode</a></li><li><a href="#configure-ulimit" class="table-of-contents__link toc-highlight">Configure <code>ulimit</code></a></li><li><a href="#docker-service" class="table-of-contents__link toc-highlight">Docker service</a></li><li><a href="#kubernetes-service" class="table-of-contents__link toc-highlight">Kubernetes service</a></li><li><a href="#tidb-clusters-requirements-for-resources" class="table-of-contents__link toc-highlight">TiDB cluster&#39;s requirements for resources</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docusaurus-operator/">User Manual</a></li><li class="footer__item"><a class="footer__link-item" href="/docusaurus-operator/architecture">Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/tidb" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://tidb.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>tidb.io<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/pingcap" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/pingcap/tidb-operator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Source Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 TiDB in Kubernetes Docs, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docusaurus-operator/assets/js/runtime~main.7b6c7d1a.js"></script>
<script src="/docusaurus-operator/assets/js/main.81ad91ac.js"></script>
</body>
</html>