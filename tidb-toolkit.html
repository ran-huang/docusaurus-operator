<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.16">
<title data-rh="true">Tools in Kubernetes | TiDB in Kubernetes Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ran-huang.github.io/docusaurus-operator/tidb-toolkit"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Tools in Kubernetes | TiDB in Kubernetes Docs"><meta data-rh="true" name="description" content="Operations on TiDB in Kubernetes require some open source tools. In the meantime, there are some special requirements for operations using TiDB tools in the Kubernetes environment. This documents introduces in details the related operation tools for TiDB in Kubernetes."><meta data-rh="true" property="og:description" content="Operations on TiDB in Kubernetes require some open source tools. In the meantime, there are some special requirements for operations using TiDB tools in the Kubernetes environment. This documents introduces in details the related operation tools for TiDB in Kubernetes."><link data-rh="true" rel="icon" href="/docusaurus-operator/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ran-huang.github.io/docusaurus-operator/tidb-toolkit"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/docusaurus-operator/tidb-toolkit" hreflang="en"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/docusaurus-operator/tidb-toolkit" hreflang="x-default"><link rel="stylesheet" href="/docusaurus-operator/assets/css/styles.68554639.css">
<link rel="preload" href="/docusaurus-operator/assets/js/runtime~main.f81f0faa.js" as="script">
<link rel="preload" href="/docusaurus-operator/assets/js/main.5a4d47d5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docusaurus-operator/"><div class="navbar__logo"><img src="/docusaurus-operator/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/docusaurus-operator/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">TiDB in Kubernetes</b></a><a class="navbar__item navbar__link" href="/docusaurus-operator/">Docs</a><a class="navbar__item navbar__link navbar__link--active" href="/docusaurus-operator/architecture">Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ran-huang/docusaurus-operator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/architecture">Architecture</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/benchmark-sysbench">TiDB in Kubernetes Sysbench Performance Test</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/pingcap/tidb-operator/blob/master/docs/api-references/docs.md" target="_blank" rel="noopener noreferrer" class="menu__link"><span>API References<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/cheat-sheet">Command Cheat Sheet for TiDB Cluster Management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/tidb-operator-rbac">RBAC rules required by TiDB Operator</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docusaurus-operator/use-tkctl">Tools</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/use-tkctl">TiDB Kubernetes Control User Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docusaurus-operator/tidb-toolkit">Tools in Kubernetes</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/configure-tidb-binlog-drainer">Configure</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/logs-collection">TiDB Log Collection in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/monitor-kubernetes">Monitoring and Alerts on Kubernetes</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Tools</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docusaurus-operator/tidb-toolkit">Tools in Kubernetes</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Tools in Kubernetes</h1><p>Operations on TiDB in Kubernetes require some open source tools. In the meantime, there are some special requirements for operations using TiDB tools in the Kubernetes environment. This documents introduces in details the related operation tools for TiDB in Kubernetes.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="use-pd-control-in-kubernetes">Use PD Control in Kubernetes<a class="hash-link" href="#use-pd-control-in-kubernetes" title="Direct link to heading">â€‹</a></h2><p><a href="https://pingcap.com/docs/stable/reference/tools/pd-control" target="_blank" rel="noopener noreferrer">PD Control</a> is the command-line tool for PD (Placement Driver). To use PD Control to operate on TiDB clusters in Kubernetes, firstly you need to establish the connection from local to the PD service using <code>kubectl port-forward</code>:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> svc/</span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-pd </span><span class="token number" style="color:#36acaa">2379</span><span class="token plain">:2379 </span><span class="token operator" style="color:#393A34">&amp;&gt;</span><span class="token plain">/tmp/portforward-pd.log </span><span class="token operator" style="color:#393A34">&amp;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>After the above command is executed, you can access the PD service via <code>127.0.0.1:2379</code>, and then use the default parameters of <code>pd-ctl</code> to operate. For example:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">pd-ctl -d config show</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Assume that your local port <code>2379</code> has been occupied and you want to switch to another port:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> svc/</span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-pd </span><span class="token variable" style="color:#36acaa">${local_port}</span><span class="token plain">:2379 </span><span class="token operator" style="color:#393A34">&amp;&gt;</span><span class="token plain">/tmp/portforward-pd.log </span><span class="token operator" style="color:#393A34">&amp;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then you need to explicitly assign a PD port for <code>pd-ctl</code>:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">pd-ctl -u </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:</span><span class="token variable" style="color:#36acaa">${local_port}</span><span class="token plain"> -d config show</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="use-tikv-control-in-kubernetes">Use TiKV Control in Kubernetes<a class="hash-link" href="#use-tikv-control-in-kubernetes" title="Direct link to heading">â€‹</a></h2><p><a href="https://pingcap.com/docs/stable/reference/tools/tikv-control" target="_blank" rel="noopener noreferrer">TiKV Control</a> is the command-line tool for TiKV. When using TiKV Control for TiDB clusters in Kubernetes, be aware that each operation mode involves different steps, as described below:</p><ul><li><p><strong>Remote Mode</strong>: In this mode, <code>tikv-ctl</code> accesses the TiKV service or the PD service through network. Firstly you need to establish the connection from local to the PD service and the target TiKV node using <code>kubectl port-forward</code>:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> svc/</span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-pd </span><span class="token number" style="color:#36acaa">2379</span><span class="token plain">:2379 </span><span class="token operator" style="color:#393A34">&amp;&gt;</span><span class="token plain">/tmp/portforward-pd.log </span><span class="token operator" style="color:#393A34">&amp;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${pod_name}</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20160</span><span class="token plain">:20160 </span><span class="token operator" style="color:#393A34">&amp;&gt;</span><span class="token plain">/tmp/portforward-tikv.log </span><span class="token operator" style="color:#393A34">&amp;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>  After the connection is established, you can access the PD service and the TiKV node via the corresponding port in local:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">tikv-ctl --host </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:20160 </span><span class="token variable" style="color:#36acaa">${subcommands}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">tikv-ctl --pd </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:2379 compact-cluster</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p><strong>Local Mode</strong>ï¼šIn this mode, <code>tikv-ctl</code> accesses data files of TiKV, and the running TiKV instances must be stopped. To operate in the local mode, first you need to enter the <a href="/docusaurus-operator/tips#use-the-diagnostic-mode">Diagnostic Mode</a> to turn off automatic re-starting for the TiKV instance, stop the TiKV process, and enter the target TiKV Pod and use <code>tikv-ctl</code> to perform the operation. The steps are as follows:</p><ol><li><p>Enter the Diagnostic mode:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl annotate pod </span><span class="token variable" style="color:#36acaa">${pod_name}</span><span class="token plain"> -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">runmode</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">debug</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Stop the TiKV process:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${pod_name}</span><span class="token plain"> -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> -c tikv -- </span><span class="token function" style="color:#d73a49">kill</span><span class="token plain"> -s </span><span class="token environment constant" style="color:#36acaa">TERM</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Wait for the TiKV container to restart, and enter the container:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -it </span><span class="token variable" style="color:#36acaa">${pod_name}</span><span class="token plain"> -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> -- </span><span class="token function" style="color:#d73a49">sh</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Start using <code>tikv-ctl</code> in local mode. The default db path in the TiKV container is <code>/var/lib/tikv/db</code>:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">./tikv-ctl --data-dir /var/lib/tikv size -r </span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="use-tidb-control-in-kubernetes">Use TiDB Control in Kubernetes<a class="hash-link" href="#use-tidb-control-in-kubernetes" title="Direct link to heading">â€‹</a></h2><p><a href="https://pingcap.com/docs/stable/reference/tools/tidb-control" target="_blank" rel="noopener noreferrer">TiDB Control</a> is the command-line tool for TiDB. To use TiDB Control in Kubernetes, you need to access the TiDB node and the PD service from local. It is suggested you turn on the connection from local to the TiDB node and the PD service using <code>kubectl port-forward</code>:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> svc/</span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-pd </span><span class="token number" style="color:#36acaa">2379</span><span class="token plain">:2379 </span><span class="token operator" style="color:#393A34">&amp;&gt;</span><span class="token plain">/tmp/portforward-pd.log </span><span class="token operator" style="color:#393A34">&amp;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${pod_name}</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10080</span><span class="token plain">:10080 </span><span class="token operator" style="color:#393A34">&amp;&gt;</span><span class="token plain">/tmp/portforward-tidb.log </span><span class="token operator" style="color:#393A34">&amp;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then you can use the <code>tidb-ctl</code>:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">tidb-ctl schema </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> mysql</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="use-helm">Use Helm<a class="hash-link" href="#use-helm" title="Direct link to heading">â€‹</a></h2><p><a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm</a> is a package management tool for Kubernetes. The installation steps are as follows:</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="install-the-helm-client">Install the Helm client<a class="hash-link" href="#install-the-helm-client" title="Direct link to heading">â€‹</a></h3><p>Refer to <a href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener noreferrer">Helm official documentation</a> to install the Helm client.</p><p>If the server does not have access to the Internet, you need to download Helm on a machine with Internet access, and then copy it to the server. Here is an example of installing the Helm client <code>3.4.1</code>:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://get.helm.sh/helm-v3.4.1-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> zxvf helm-v3.4.1-linux-amd64.tar.gz</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>After decompression, you can see the following files:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">linux-amd64/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">linux-amd64/README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">linux-amd64/helm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">linux-amd64/LICENSE</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Copy the <code>linux-amd64/helm</code> file to the server and place it under the <code>/usr/local/bin/</code> directory.</p><p>Then execute <code>helm verison</code>. If the command outputs normally, the Helm installation is successful:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm version</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">version.BuildInfo</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">Version:</span><span class="token string" style="color:#e3116c">&quot;v3.4.1&quot;</span><span class="token plain">, GitCommit:</span><span class="token string" style="color:#e3116c">&quot;c4e74854886b2efe3321e185578e6db9be0a6e29&quot;</span><span class="token plain">, GitTreeState:</span><span class="token string" style="color:#e3116c">&quot;clean&quot;</span><span class="token plain">, GoVersion:</span><span class="token string" style="color:#e3116c">&quot;go1.14.11&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="configure-the-helm-repo">Configure the Helm repo<a class="hash-link" href="#configure-the-helm-repo" title="Direct link to heading">â€‹</a></h3><p>Kubernetes applications are packed as charts in Helm. PingCAP provides the following Helm charts for TiDB in Kubernetes:</p><ul><li><code>tidb-operator</code>: used to deploy TiDB Operator;</li><li><code>tidb-cluster</code>: used to deploy TiDB clusters;</li><li><code>tidb-backup</code>: used to back up or restore TiDB clusters;</li><li><code>tidb-lightning</code>: used to import data into a TiDB cluster;</li><li><code>tidb-drainer</code>: used to deploy TiDB Drainer;</li><li><code>tikv-importer</code>: used to deploy TiKV Importer.</li></ul><p>These charts are hosted in the Helm chart repository <code>https://charts.pingcap.org/</code> maintained by PingCAP. You can add this repository to your local server or computer using the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> pingcap https://charts.pingcap.org/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Then you can search the chart provided by PingCAP using the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm search repo pingcap</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                    CHART VERSION   APP VERSION     DESCRIPTION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pingcap/tidb-backup     v1.2.7                  A Helm chart for TiDB Backup or Restore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pingcap/tidb-cluster    v1.2.7                  A Helm chart for TiDB Cluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pingcap/tidb-drainer    v1.2.7                  A Helm chart for TiDB Binlog drainer.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pingcap/tidb-lightning  v1.2.7                  A Helm chart for TiDB Lightning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pingcap/tidb-operator   v1.2.7  v1.2.7  tidb-operator Helm chart for Kubernetes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pingcap/tikv-importer   v1.2.7                  A Helm chart for TiKV Importer</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When a new version of chart has been released, you can use <code>helm repo update</code> to update the repository cached locally:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="helm-common-operations">Helm common operations<a class="hash-link" href="#helm-common-operations" title="Direct link to heading">â€‹</a></h3><p>Common Helm operations include <code>helm install</code>, <code>helm upgrade</code>, and <code>helm uninstall</code>. Helm chart usually contains many configurable parameters which could be tedious to configure manually. For convenience, it is recommended that you configure using a YAML file. Based on the conventions in the Helm community, the YAML file used for Helm configuration is named <code>values.yaml</code> in this document.</p><p>Before performing the deploy, upgrade and deploy, you can view the deployed applications via <code>helm ls</code>:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">ls</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When performing a deployment or upgrade, you must specify the chart name (<code>chart-name</code>) and the name for the deployed application (<code>release-name</code>). You can also specify one or multiple <code>values.yaml</code> files to configure charts. In addition, you can use <code>chart-version</code> to specify the chart version (by default the latest GA is used). The steps in command line are as follows:</p><ul><li><p>Install:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${release_name}</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${chart_name}</span><span class="token plain"> --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> --version</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${chart_version}</span><span class="token plain"> -f </span><span class="token variable" style="color:#36acaa">${values_file}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Upgrade (the upgrade can be either modifying the <code>chart-version</code> to upgrade to the latest chart version, or editing the <code>values.yaml</code> file to update the configuration):</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade </span><span class="token variable" style="color:#36acaa">${release_name}</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${chart_name}</span><span class="token plain"> --version</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${chart_version}</span><span class="token plain"> -f </span><span class="token variable" style="color:#36acaa">${values_file}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Delete:</p><p>  To delete the application deployed by Helm, run the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm uninstall </span><span class="token variable" style="color:#36acaa">${release_name}</span><span class="token plain"> -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul><p>For more information on Helm, refer to <a href="https://helm.sh/docs/" target="_blank" rel="noopener noreferrer">Helm Documentation</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="use-helm-chart-offline">Use Helm chart offline<a class="hash-link" href="#use-helm-chart-offline" title="Direct link to heading">â€‹</a></h3><p>If the server has no Internet access, you cannot configure the Helm repo to install the TiDB Operator component and other applications. At this time, you need to download the chart file needed for cluster installation on a machine with Internet access, and then copy it to the server.</p><p>Use the following command to download the chart file required for cluster installation:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> http://charts.pingcap.org/tidb-operator-v1.2.7.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> http://charts.pingcap.org/tidb-drainer-v1.2.7.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> http://charts.pingcap.org/tidb-lightning-v1.2.7.tgz</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Copy these chart files to the server and decompress them. You can use these charts to install the corresponding components by running the <code>helm install</code> command. Take <code>tidb-operator</code> as an example:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> zxvf tidb-operator.v1.2.7.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${release_name}</span><span class="token plain"> ./tidb-operator --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="use-terraform">Use Terraform<a class="hash-link" href="#use-terraform" title="Direct link to heading">â€‹</a></h2><p><a href="https://www.terraform.io/" target="_blank" rel="noopener noreferrer">Terraform</a> is a Infrastructure as Code management tool. It enables users to define their own infrastructure in a  manifestation style, based on which execution plans are generated to create or schedule real world compute resources. TiDB in Kubernetes use Terraform to create and manage TiDB clusters on public clouds.</p><p>Follow the steps in <a href="https://www.terraform.io/downloads.html" target="_blank" rel="noopener noreferrer">Terraform Documentation</a> to install Terraform.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tidb-toolkit.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docusaurus-operator/use-tkctl"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">TiDB Kubernetes Control User Guide</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docusaurus-operator/configure-tidb-binlog-drainer"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">TiDB Binlog Drainer Configurations in Kubernetes</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#use-pd-control-in-kubernetes" class="table-of-contents__link toc-highlight">Use PD Control in Kubernetes</a></li><li><a href="#use-tikv-control-in-kubernetes" class="table-of-contents__link toc-highlight">Use TiKV Control in Kubernetes</a></li><li><a href="#use-tidb-control-in-kubernetes" class="table-of-contents__link toc-highlight">Use TiDB Control in Kubernetes</a></li><li><a href="#use-helm" class="table-of-contents__link toc-highlight">Use Helm</a><ul><li><a href="#install-the-helm-client" class="table-of-contents__link toc-highlight">Install the Helm client</a></li><li><a href="#configure-the-helm-repo" class="table-of-contents__link toc-highlight">Configure the Helm repo</a></li><li><a href="#helm-common-operations" class="table-of-contents__link toc-highlight">Helm common operations</a></li><li><a href="#use-helm-chart-offline" class="table-of-contents__link toc-highlight">Use Helm chart offline</a></li></ul></li><li><a href="#use-terraform" class="table-of-contents__link toc-highlight">Use Terraform</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docusaurus-operator/">User Manual</a></li><li class="footer__item"><a class="footer__link-item" href="/docusaurus-operator/architecture">Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/tidb" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://tidb.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>tidb.io<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/pingcap" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/pingcap/tidb-operator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Source Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 TiDB in Kubernetes Docs, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docusaurus-operator/assets/js/runtime~main.f81f0faa.js"></script>
<script src="/docusaurus-operator/assets/js/main.5a4d47d5.js"></script>
</body>
</html>