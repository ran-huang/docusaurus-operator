<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.16">
<title data-rh="true">Deploy TiDB on Alibaba Cloud Kubernetes | TiDB in Kubernetes Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ran-huang.github.io/docusaurus-operator/deploy-on-alibaba-cloud"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deploy TiDB on Alibaba Cloud Kubernetes | TiDB in Kubernetes Docs"><meta data-rh="true" name="description" content="This document describes how to deploy a TiDB cluster on Alibaba Cloud Kubernetes with your laptop (Linux or macOS) for development or testing."><meta data-rh="true" property="og:description" content="This document describes how to deploy a TiDB cluster on Alibaba Cloud Kubernetes with your laptop (Linux or macOS) for development or testing."><link data-rh="true" rel="icon" href="/docusaurus-operator/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ran-huang.github.io/docusaurus-operator/deploy-on-alibaba-cloud"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/docusaurus-operator/deploy-on-alibaba-cloud" hreflang="en"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/docusaurus-operator/deploy-on-alibaba-cloud" hreflang="x-default"><link rel="stylesheet" href="/docusaurus-operator/assets/css/styles.732b35c1.css">
<link rel="preload" href="/docusaurus-operator/assets/js/runtime~main.b87ef9bf.js" as="script">
<link rel="preload" href="/docusaurus-operator/assets/js/main.51dee141.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docusaurus-operator/"><div class="navbar__logo"><img src="/docusaurus-operator/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/docusaurus-operator/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">TiDB in Kubernetes</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docusaurus-operator/">Docs</a><a class="navbar__item navbar__link" href="/docusaurus-operator/architecture">Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ran-huang/docs-tidb-operator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docusaurus-operator/">TiDB in Kubernetes</a><button aria-label="Toggle the collapsible sidebar category &#x27;TiDB in Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/get-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docusaurus-operator/prerequisites">Deploy</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docusaurus-operator/prerequisites">In Self-Managed Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docusaurus-operator/deploy-on-aws-eks">In Public Cloud Kubernetes</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-on-aws-eks">Deploy TiDB on AWS EKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-on-gcp-gke">Deploy TiDB on GCP GKE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-on-azure-aks">Deploy TiDB on Azure AKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docusaurus-operator/deploy-on-alibaba-cloud">Deploy TiDB on Alibaba Cloud Kubernetes</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-cluster-on-arm64">On ARM64</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-tiflash">HTAP</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docusaurus-operator/build-multi-aws-eks">Across Multiple Kubernetes Clusters</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-heterogeneous-tidb-cluster">Heterogeneous Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-tidb-enterprise-edition">Enterprise Edition</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-ticdc">TiCDC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-tidb-binlog">TiDB Binlog</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/restore-data-using-tidb-lightning">Migrate</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/enable-tls-for-mysql-client">Manage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/tips">Troubleshoot</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/faq">TiDB FAQs in Kubernetes</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Deploy</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">In Public Cloud Kubernetes</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docusaurus-operator/deploy-on-alibaba-cloud">Deploy TiDB on Alibaba Cloud Kubernetes</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Deploy TiDB on Alibaba Cloud Kubernetes</h1><p>This document describes how to deploy a TiDB cluster on Alibaba Cloud Kubernetes with your laptop (Linux or macOS) for development or testing.</p><p>To deploy TiDB Operator and the TiDB cluster in a self-managed Kubernetes environment, refer to <a href="/docusaurus-operator/deploy-tidb-operator">Deploy TiDB Operator</a> and <a href="/docusaurus-operator/deploy-on-general-kubernetes">Deploy TiDB in General Kubernetes</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">â€‹</a></h2><ul><li><p><a href="https://github.com/aliyun/aliyun-cli" target="_blank" rel="noopener noreferrer"><code>aliyun-cli</code></a> &gt;= 3.0.15 and <a href="https://www.alibabacloud.com/help/doc-detail/90766.htm?spm=a2c63.l28256.a3.4.7b52a893EFVglq" target="_blank" rel="noopener noreferrer">configure <code>aliyun-cli</code></a></p><blockquote><p><strong>Note:</strong></p><p>The access key must be granted permissions to control the corresponding resources.</p></blockquote></li><li><p><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener noreferrer">kubectl</a> &gt;= 1.12</p></li><li><p><a href="https://helm.sh" target="_blank" rel="noopener noreferrer">Helm 3</a></p></li><li><p><a href="https://stedolan.github.io/jq/download/" target="_blank" rel="noopener noreferrer">jq</a> &gt;= 1.6</p></li><li><p><a href="https://learn.hashicorp.com/terraform/getting-started/install.html" target="_blank" rel="noopener noreferrer">terraform</a> 0.12.*</p></li></ul><p>You can use <a href="https://shell.aliyun.com" target="_blank" rel="noopener noreferrer">Cloud Shell</a> of Alibaba Cloud to perform operations. All the tools have been pre-installed and configured in the Cloud Shell of Alibaba Cloud.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="required-privileges">Required privileges<a class="hash-link" href="#required-privileges" title="Direct link to heading">â€‹</a></h3><p>To deploy a TiDB cluster, make sure you have the following privileges:</p><ul><li>AliyunECSFullAccess</li><li>AliyunESSFullAccess</li><li>AliyunVPCFullAccess</li><li>AliyunSLBFullAccess</li><li>AliyunCSFullAccess</li><li>AliyunEIPFullAccess</li><li>AliyunECIFullAccess</li><li>AliyunVPNGatewayFullAccess</li><li>AliyunNATGatewayFullAccess</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="overview-of-things-to-create">Overview of things to create<a class="hash-link" href="#overview-of-things-to-create" title="Direct link to heading">â€‹</a></h2><p>In the default configuration, you will create:</p><ul><li><p>A new VPC</p></li><li><p>An ECS instance as the bastion machine</p></li><li><p>A managed ACK (Alibaba Cloud Kubernetes) cluster with the following ECS instance worker nodes:</p><ul><li>An auto-scaling group of 2 * instances (2 cores, 2 GB RAM). The default auto-scaling group of managed Kubernetes must have at least two instances to host the whole system service, like CoreDNS</li><li>An auto-scaling group of 3 * <code>ecs.g5.large</code> instances for deploying the PD cluster</li><li>An auto-scaling group of 3 * <code>ecs.i2.2xlarge</code> instances for deploying the TiKV cluster</li><li>An auto-scaling group of 2 * <code>ecs.c5.4xlarge</code> instances for deploying the TiDB cluster</li><li>An auto-scaling group of 1 * <code>ecs.c5.xlarge</code> instance for deploying monitoring components</li><li>A 100 GB cloud disk used to store monitoring data</li></ul></li></ul><p>All the instances except ACK mandatory workers are deployed across availability zones (AZs) to provide cross-AZ high availability. The auto-scaling group ensures the desired number of healthy instances, so the cluster can auto-recover from node failure or even AZ failure.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="deploy">Deploy<a class="hash-link" href="#deploy" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="deploy-ack-tidb-operator-and-the-node-pool-for-tidb-cluster">Deploy ACK, TiDB Operator and the node pool for TiDB cluster<a class="hash-link" href="#deploy-ack-tidb-operator-and-the-node-pool-for-tidb-cluster" title="Direct link to heading">â€‹</a></h3><ol><li><p>Configure the target region and Alibaba Cloud key (you can also set these variables in the <code>terraform</code> command prompt):</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_ALICLOUD_REGION</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${REGION}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_ALICLOUD_ACCESS_KEY</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${ACCESS_KEY}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">TF_VAR_ALICLOUD_SECRET_KEY</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${SECRET_KEY}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>variables.tf</code> file contains default settings of variables used for deploying the cluster. You can change it or use the <code>-var</code> option to override a specific variable to fit your need.</p></li><li><p>Use Terraform to set up the cluster.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone --depth</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> https://github.com/pingcap/tidb-operator </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> tidb-operator/deploy/aliyun</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can create or modify <code>terraform.tfvars</code> to set the values of the variables, and configure the cluster to fit your needs. You can view the configurable variables and their descriptions in <code>variables.tf</code>. The following is an example of how to configure the ACK cluster name, the TiDB cluster name, the TiDB Operator version, and the number of PD, TiKV, and TiDB nodes.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">cluster_name = &quot;testack&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb_cluster_name = &quot;testdb&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tikv_count = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb_count = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pd_count = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">operator_version = &quot;v1.2.7&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li><p>To deploy TiFlash in the cluster, set <code>create_tiflash_node_pool = true</code> in <code>terraform.tfvars</code>. You can also configure the node count and instance type of the TiFlash node pool by modifying <code>tiflash_count</code> and <code>tiflash_instance_type</code>. By default, the value of <code>tiflash_count</code> is <code>2</code>, and the value of <code>tiflash_instance_type</code> is <code>ecs.i2.2xlarge</code>.</p></li><li><p>To deploy TiCDC in the cluster, set <code>create_cdc_node_pool = true</code> in <code>terraform.tfvars</code>. You can also configure the node count and instance type of the TiCDC node pool by modifying <code>cdc_count</code> and <code>cdc_instance_type</code>. By default, the value of <code>cdc_count</code> is <code>3</code>, and the value of <code>cdc_instance_type</code> is <code>ecs.c5.2xlarge</code>.</p></li></ul><blockquote><p><strong>Note:</strong></p><p>Check the <code>operator_version</code> in the <code>variables.tf</code> file for the default TiDB Operator version of the current scripts. If the default version is not your desired one, configure <code>operator_version</code> in <code>terraform.tfvars</code>.</p></blockquote><p>After the configuration, execute the following commands to initialize and deploy the cluster:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">terraform init</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Input &quot;yes&quot; to confirm execution when you run the following <code>apply</code> command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">terraform apply</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If you get an error while running <code>terraform apply</code>, fix the error (for example, lack of permission) according to the error description and run <code>terraform apply</code> again.</p><p>It takes 5 to 10 minutes to create the whole stack using <code>terraform apply</code>. Once the installation is complete, the basic cluster information is printed:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Apply complete! Resources: 3 added, 0 changed, 1 destroyed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Outputs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bastion_ip = 47.96.174.214</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cluster_id = c2d9b20854a194f158ef2bc8ea946f20e</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeconfig_file = /tidb-operator/deploy/aliyun/credentials/kubeconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">monitor_endpoint = not_created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">region = cn-hangzhou</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh_key_file = /tidb-operator/deploy/aliyun/credentials/my-cluster-keyZ.pem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb_endpoint = not_created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb_version = v3.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vpc_id = vpc-bp1v8i5rwsc7yh8dwyep5</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p><strong>Note:</strong></p><p>You can use the <code>terraform output</code> command to get the output again.</p></blockquote></li><li><p>You can then interact with the ACK cluster using <code>kubectl</code> or <code>helm</code>:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">KUBECONFIG</span><span class="token operator" style="color:#393A34">=</span><span class="token environment constant" style="color:#36acaa">$PWD</span><span class="token plain">/credentials/kubeconfig</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl version</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">ls</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="deploy-the-tidb-cluster-and-monitor">Deploy the TiDB cluster and monitor<a class="hash-link" href="#deploy-the-tidb-cluster-and-monitor" title="Direct link to heading">â€‹</a></h3><ol><li><p>Prepare the <code>TidbCluster</code> and <code>TidbMonitor</code> CR files:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> manifests/db.yaml.example db.yaml </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> manifests/db-monitor.yaml.example db-monitor.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>To complete the CR file configuration, refer to <a href="https://github.com/pingcap/tidb-operator/blob/master/docs/api-references/docs.md" target="_blank" rel="noopener noreferrer">TiDB Operator API documentation</a> and <a href="/docusaurus-operator/configure-a-tidb-cluster">Configure a TiDB Cluster</a>.</p><ul><li><p>To deploy TiFlash, configure <code>spec.tiflash</code> in <code>db.yaml</code> as follows:</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tiflash</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">baseImage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pingcap/tiflash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxFailoverCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nodeSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">dedicated</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TIDB_CLUSTER_NAME</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">tiflash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storageClaims</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> local</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">volume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tolerations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">effect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dedicated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Equal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TIDB_CLUSTER_NAME</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">tiflash</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>  To configure other parameters, refer to <a href="/docusaurus-operator/configure-a-tidb-cluster">Configure a TiDB Cluster</a>.</p><p>  Modify <code>replicas</code>, <code>storageClaims[].resources.requests.storage</code>, and <code>storageClassName</code> according to your needs.</p><blockquote><p><strong>Warning:</strong></p><p>Since TiDB Operator will mount PVs automatically in the <strong>order</strong> of the items in the <code>storageClaims</code> list, if you need to add more disks to TiFlash, make sure to append the new item only to the <strong>end</strong> of the original items, and <strong>DO NOT</strong> modify the order of the original items.</p></blockquote></li><li><p>To deploy TiCDC, configure <code>spec.ticdc</code> in <code>db.yaml</code> as follows:</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">spec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ticdc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">baseImage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pingcap/ticdc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nodeSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">dedicated</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TIDB_CLUSTER_NAME</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cdc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tolerations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">effect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dedicated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Equal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> TIDB_CLUSTER_NAME</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cdc</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>  Modify <code>replicas</code> according to your needs.</p></li></ul><p>To deploy Enterprise Edition of TiDB/PD/TiKV/TiFlash/TiCDC, edit the <code>db.yaml</code> file to set <code>spec.&lt;tidb/pd/tikv/tiflash/ticdc&gt;.baseImage</code> to the enterprise image (<code>pingcap/&lt;tidb/pd/tikv/tiflash/ticdc&gt;-enterprise</code>).</p><p>For example:</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">baseImage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pingcap/pd</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">enterprise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tikv</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">baseImage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pingcap/tikv</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">enterprise</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p><strong>Note:</strong></p><ul><li>Replace all the <code>TIDB_CLUSTER_NAME</code> in the <code>db.yaml</code> and <code>db-monitor.yaml</code> files with <code>tidb_cluster_name</code> configured in the deployment of ACK.</li><li>Make sure the number of PD, TiKV, TiFlash, TiCDC, or TiDB nodes is &gt;= the <code>replicas</code> value of the corresponding component in <code>db.yaml</code>.</li><li>Make sure <code>spec.initializer.version</code> in <code>db-monitor.yaml</code> is the same as <code>spec.version</code> in <code>db.yaml</code>. Otherwise, the monitor might not display correctly.</li></ul></blockquote></li><li><p>Create <code>Namespace</code>:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl --kubeconfig credentials/kubeconfig create namespace </span><span class="token variable" style="color:#36acaa">${namespace}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p><strong>Note:</strong></p><p>You can give the <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/" target="_blank" rel="noopener noreferrer"><code>namespace</code></a> a name that is easy to memorize, such as the same name as <code>tidb_cluster_name</code>.</p></blockquote></li><li><p>Deploy the TiDB cluster:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl --kubeconfig credentials/kubeconfig create -f db.yaml -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl --kubeconfig credentials/kubeconfig create -f db-monitor.yaml -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If you need to deploy a TiDB cluster on ARM64 machines, refer to <a href="/docusaurus-operator/deploy-cluster-on-arm64">Deploy a TiDB Cluster on ARM64 Machines</a>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="access-the-database">Access the database<a class="hash-link" href="#access-the-database" title="Direct link to heading">â€‹</a></h2><p>You can connect the TiDB cluster via the bastion instance. All necessary information is in the output printed after installation is finished (replace the <code>${}</code> parts with values from the output):</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> -i credentials/</span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-key.pem root@</span><span class="token variable" style="color:#36acaa">${bastion_ip}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">mysql -h </span><span class="token variable" style="color:#36acaa">${tidb_lb_ip}</span><span class="token plain"> -P </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"> -u root</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>tidb_lb_ip</code> is the LoadBalancer IP of the TiDB service.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li><a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_default_authentication_plugin" target="_blank" rel="noopener noreferrer">The default authentication plugin of MySQL 8.0</a> is updated from <code>mysql_native_password</code> to <code>caching_sha2_password</code>. Therefore, if you use MySQL client from MySQL 8.0 to access the TiDB service (TiDB version &lt; v4.0.7), and if the user account has a password, you need to explicitly specify the <code>--default-auth=mysql_native_password</code> parameter.</li><li>By default, TiDB (starting from v4.0.2) periodically shares usage details with PingCAP to help understand how to improve the product. For details about what is shared and how to disable the sharing, see <a href="https://docs.pingcap.com/tidb/stable/telemetry" target="_blank" rel="noopener noreferrer">Telemetry</a>.</li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="monitor">Monitor<a class="hash-link" href="#monitor" title="Direct link to heading">â€‹</a></h2><p>Visit <code>&lt;monitor-lb&gt;:3000</code> to view the Grafana dashboards. <code>monitor-lb</code> is the LoadBalancer IP of the Monitor service.</p><p>The initial login user account and password:</p><ul><li>User: admin</li><li>Password: admin</li></ul><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Warning</h5></div><div class="admonition-content"><p>If you already have a VPN connecting to your VPC or plan to set up one, it is strongly recommended that you go to the <code>spec.grafana.service.annotations</code> section in the <code>db-monitor.yaml</code> file and set <code>service.beta.kubernetes.io/alicloud-loadbalancer-address-type</code> to <code>intranet</code> for security.</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="upgrade">Upgrade<a class="hash-link" href="#upgrade" title="Direct link to heading">â€‹</a></h2><p>To upgrade the TiDB cluster, modify the <code>spec.version</code> variable by executing <code>kubectl --kubeconfig credentials/kubeconfig patch tc ${tidb_cluster_name} -n ${namespace} --type merge -p &#x27;{&quot;spec&quot;:{&quot;version&quot;:&quot;${version}&quot;}}</code>.</p><p>This may take a while to complete. You can watch the process using the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --namespace </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> -o wide --watch</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="scale-out-the-tidb-cluster">Scale out the TiDB cluster<a class="hash-link" href="#scale-out-the-tidb-cluster" title="Direct link to heading">â€‹</a></h2><p>To scale out the TiDB cluster, modify <code>tikv_count</code>, <code>tiflash_count</code>, <code>cdc_count</code>, or <code>tidb_count</code> in the <code>terraform.tfvars</code> file, and then run <code>terraform apply</code> to scale out the number of nodes for the corresponding components.</p><p>After the nodes scale out, modify the <code>replicas</code> of the corresponding components by running <code>kubectl --kubeconfig credentials/kubeconfig edit tc ${tidb_cluster_name} -n ${namespace}</code>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>Because it is impossible to determine which node will be taken offline during the scale-in process, the scale-in of TiDB clusters is currently not supported.</li><li>The scale-out process takes a few minutes. You can watch the status by running <code>kubectl --kubeconfig credentials/kubeconfig get po -n ${namespace} --watch</code>.</li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="configure">Configure<a class="hash-link" href="#configure" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="configure-tidb-operator">Configure TiDB Operator<a class="hash-link" href="#configure-tidb-operator" title="Direct link to heading">â€‹</a></h3><p>You can set the variables in <code>terraform.tfvars</code> to configure TiDB Operator. Most configuration items can be modified after you understand the semantics based on the comments of the <code>variable</code>. Note that the <code>operator_helm_values</code> configuration item can provide a customized <code>values.yaml</code> configuration file for TiDB Operator. For example:</p><ul><li><p>Set <code>operator_helm_values</code> in <code>terraform.tfvars</code>:</p><div class="codeBlockContainer_I0IT language-hcl theme-code-block"><div class="codeBlockContent_wNvx hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">operator_helm_values = &quot;./my-operator-values.yaml&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Set <code>operator_helm_values</code> in <code>main.tf</code>:</p><div class="codeBlockContainer_I0IT language-hcl theme-code-block"><div class="codeBlockContent_wNvx hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">operator_helm_values = file(&quot;./my-operator-values.yaml&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul><p>In the default configuration, the Terraform script creates a new VPC. To use the existing VPC, set <code>vpc_id</code> in <code>variable.tf</code>. In this case, Kubernetes nodes are not deployed in AZs with vSwitch not configured.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="configure-the-tidb-cluster">Configure the TiDB cluster<a class="hash-link" href="#configure-the-tidb-cluster" title="Direct link to heading">â€‹</a></h3><p>See <a href="https://github.com/pingcap/tidb-operator/blob/master/docs/api-references/docs.md" target="_blank" rel="noopener noreferrer">TiDB Operator API Documentation</a> and <a href="/docusaurus-operator/configure-a-tidb-cluster">Configure a TiDB Cluster</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="manage-multiple-tidb-clusters">Manage multiple TiDB clusters<a class="hash-link" href="#manage-multiple-tidb-clusters" title="Direct link to heading">â€‹</a></h2><p>To manage multiple TiDB clusters in a single Kubernetes cluster, you need to edit <code>./main.tf</code> and add the <code>tidb-cluster</code> declaration based on your needs. For example:</p><div class="codeBlockContainer_I0IT language-hcl theme-code-block"><div class="codeBlockContent_wNvx hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">module &quot;tidb-cluster-dev&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source = &quot;../modules/aliyun/tidb-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  providers = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    helm = helm.default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cluster_name = &quot;dev-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ack          = module.tidb-operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pd_count                   = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tikv_count                 = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tidb_count                 = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module &quot;tidb-cluster-staging&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source = &quot;../modules/aliyun/tidb-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  providers = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    helm = helm.default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cluster_name = &quot;staging-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ack          = module.tidb-operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pd_count                   = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tikv_count                 = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tidb_count                 = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>You need to set a unique <code>cluster_name</code> for each TiDB cluster.</p></div></div><p>All the configurable parameters in <code>tidb-cluster</code> are as follows:</p><table><thead><tr><th align="left">Parameter</th><th align="left">Description</th><th align="left">Default value</th></tr></thead><tbody><tr><td align="left"><code>ack</code></td><td align="left">The structure that enwraps the target Kubernetes cluster information (required)</td><td align="left"><code>nil</code></td></tr><tr><td align="left"><code>cluster_name</code></td><td align="left">The TiDB cluster name (required and unique)</td><td align="left"><code>nil</code></td></tr><tr><td align="left"><code>tidb_version</code></td><td align="left">The TiDB cluster version</td><td align="left"><code>v3.0.1</code></td></tr><tr><td align="left"><code>tidb_cluster_chart_version</code></td><td align="left"><code>tidb-cluster</code> helm chart version</td><td align="left"><code>v1.0.1</code></td></tr><tr><td align="left"><code>pd_count</code></td><td align="left">The number of PD nodes</td><td align="left">3</td></tr><tr><td align="left"><code>pd_instance_type</code></td><td align="left">The PD instance type</td><td align="left"><code>ecs.g5.large</code></td></tr><tr><td align="left"><code>tikv_count</code></td><td align="left">The number of TiKV nodes</td><td align="left">3</td></tr><tr><td align="left"><code>tikv_instance_type</code></td><td align="left">The TiKV instance type</td><td align="left"><code>ecs.i2.2xlarge</code></td></tr><tr><td align="left"><code>tiflash_count</code></td><td align="left">The count of TiFlash nodes</td><td align="left">2</td></tr><tr><td align="left"><code>tiflash_instance_type</code></td><td align="left">The TiFlash instance type</td><td align="left"><code>ecs.i2.2xlarge</code></td></tr><tr><td align="left"><code>cdc_count</code></td><td align="left">The count of TiCDC nodes</td><td align="left">3</td></tr><tr><td align="left"><code>cdc_instance_type</code></td><td align="left">The TiCDC instance type</td><td align="left"><code>ecs.c5.2xlarge</code></td></tr><tr><td align="left"><code>tidb_count</code></td><td align="left">The number of TiDB nodes</td><td align="left">2</td></tr><tr><td align="left"><code>tidb_instance_type</code></td><td align="left">The TiDB instance type</td><td align="left"><code>ecs.c5.4xlarge</code></td></tr><tr><td align="left"><code>monitor_instance_type</code></td><td align="left">The instance type of monitoring components</td><td align="left"><code>ecs.c5.xlarge</code></td></tr><tr><td align="left"><code>override_values</code></td><td align="left">The <code>values.yaml</code> configuration file of the TiDB cluster. You can read it using the <code>file()</code> function</td><td align="left"><code>nil</code></td></tr><tr><td align="left"><code>local_exec_interpreter</code></td><td align="left">The interpreter that executes the command line instruction</td><td align="left"><code>[&quot;/bin/sh&quot;, &quot;-c&quot;]</code></td></tr><tr><td align="left"><code>create_tidb_cluster_release</code></td><td align="left">Whether to create the TiDB cluster using Helm</td><td align="left"><code>false</code></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="manage-multiple-kubernetes-clusters">Manage multiple Kubernetes clusters<a class="hash-link" href="#manage-multiple-kubernetes-clusters" title="Direct link to heading">â€‹</a></h2><p>It is recommended to use a separate Terraform module to manage a specific Kubernetes cluster. (A Terraform module is a directory that contains the <code>.tf</code> script.)</p><p><code>deploy/aliyun</code> combines multiple reusable Terraform scripts in <code>deploy/modules</code>. To manage multiple clusters, perform the following operations in the root directory of the <code>tidb-operator</code> project:</p><ol><li><p>Create a directory for each cluster. For example:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p deploy/aliyun-staging</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Refer to <code>main.tf</code> in <code>deploy/aliyun</code> and write your own script. For example:</p><div class="codeBlockContainer_I0IT language-hcl theme-code-block"><div class="codeBlockContent_wNvx hcl"><pre tabindex="0" class="prism-code language-hcl codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">provider &quot;alicloud&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    region     = ${REGION}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access_key = ${ACCESS_KEY}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secret_key = ${SECRET_KEY}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module &quot;tidb-operator&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source     = &quot;../modules/aliyun/tidb-operator&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    region          = ${REGION}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access_key      = ${ACCESS_KEY}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secret_key      = ${SECRET_KEY}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cluster_name    = &quot;example-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key_file        = &quot;ssh-key.pem&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubeconfig_file = &quot;kubeconfig&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">provider &quot;helm&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alias    = &quot;default&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insecure = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    install_tiller = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        config_path = module.tidb-operator.kubeconfig_filename</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module &quot;tidb-cluster&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source = &quot;../modules/aliyun/tidb-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    providers = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        helm = helm.default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cluster_name = &quot;example-cluster&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ack          = module.tidb-operator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module &quot;bastion&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source = &quot;../modules/aliyun/bastion&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bastion_name             = &quot;example-bastion&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key_name                 = module.tidb-operator.key_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vpc_id                   = module.tidb-operator.vpc_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vswitch_id               = module.tidb-operator.vswitch_ids[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable_ssh_to_worker     = true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    worker_security_group_id = module.tidb-operator.security_group_id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><p>You can customize this script. For example, you can remove the <code>module &quot;bastion&quot;</code> declaration if you do not need the bastion machine.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>You can copy the <code>deploy/aliyun</code> directory. But you cannot copy a directory on which the <code>terraform apply</code> operation is currently performed. In this case, it is recommended to clone the repository again and then copy it.</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="destroy">Destroy<a class="hash-link" href="#destroy" title="Direct link to heading">â€‹</a></h2><ol><li><p>Refer to <a href="/docusaurus-operator/destroy-a-tidb-cluster">Destroy a TiDB cluster</a> to delete the cluster.</p></li><li><p>Destroy the ACK cluster by running the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">terraform destroy</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><p>If the Kubernetes cluster is not successfully created, the <code>destroy</code> operation might return an error and fail. In such cases, manually remove the Kubernetes resources from the local state:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">terraform state list</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">terraform state </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> module.ack.alicloud_cs_managed_kubernetes.k8s</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>It may take a long time to finish destroying the cluster.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>You have to manually delete the cloud disk used by the components in the Alibaba Cloud console.</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="limitation">Limitation<a class="hash-link" href="#limitation" title="Direct link to heading">â€‹</a></h2><p>You cannot change <code>pod cidr</code>, <code>service cidr</code>, and worker instance types once the cluster is created.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/deploy-on-alibaba-cloud.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docusaurus-operator/deploy-on-azure-aks"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Deploy TiDB on Azure AKS</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docusaurus-operator/deploy-cluster-on-arm64"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deploy a TiDB Cluster on ARM64 Machines</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a><ul><li><a href="#required-privileges" class="table-of-contents__link toc-highlight">Required privileges</a></li></ul></li><li><a href="#overview-of-things-to-create" class="table-of-contents__link toc-highlight">Overview of things to create</a></li><li><a href="#deploy" class="table-of-contents__link toc-highlight">Deploy</a><ul><li><a href="#deploy-ack-tidb-operator-and-the-node-pool-for-tidb-cluster" class="table-of-contents__link toc-highlight">Deploy ACK, TiDB Operator and the node pool for TiDB cluster</a></li><li><a href="#deploy-the-tidb-cluster-and-monitor" class="table-of-contents__link toc-highlight">Deploy the TiDB cluster and monitor</a></li></ul></li><li><a href="#access-the-database" class="table-of-contents__link toc-highlight">Access the database</a></li><li><a href="#monitor" class="table-of-contents__link toc-highlight">Monitor</a></li><li><a href="#upgrade" class="table-of-contents__link toc-highlight">Upgrade</a></li><li><a href="#scale-out-the-tidb-cluster" class="table-of-contents__link toc-highlight">Scale out the TiDB cluster</a></li><li><a href="#configure" class="table-of-contents__link toc-highlight">Configure</a><ul><li><a href="#configure-tidb-operator" class="table-of-contents__link toc-highlight">Configure TiDB Operator</a></li><li><a href="#configure-the-tidb-cluster" class="table-of-contents__link toc-highlight">Configure the TiDB cluster</a></li></ul></li><li><a href="#manage-multiple-tidb-clusters" class="table-of-contents__link toc-highlight">Manage multiple TiDB clusters</a></li><li><a href="#manage-multiple-kubernetes-clusters" class="table-of-contents__link toc-highlight">Manage multiple Kubernetes clusters</a></li><li><a href="#destroy" class="table-of-contents__link toc-highlight">Destroy</a></li><li><a href="#limitation" class="table-of-contents__link toc-highlight">Limitation</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docusaurus-operator/">User Manual</a></li><li class="footer__item"><a class="footer__link-item" href="/docusaurus-operator/architecture">Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/tidb" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://tidb.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>tidb.io<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/pingcap" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/pingcap/tidb-operator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Source Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 TiDB in Kubernetes Docs, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docusaurus-operator/assets/js/runtime~main.b87ef9bf.js"></script>
<script src="/docusaurus-operator/assets/js/main.51dee141.js"></script>
</body>
</html>