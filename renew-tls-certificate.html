<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.16">
<title data-rh="true">Renew and Replace the TLS Certificate | TiDB in Kubernetes Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ran-huang.github.io/renew-tls-certificate"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Renew and Replace the TLS Certificate | TiDB in Kubernetes Docs"><meta data-rh="true" name="description" content="This document introduces how to renew and replace certificates of the corresponding components before certificates expire, taking TLS certificates between PD, TiKV, and TiDB components in the TiDB cluster as an example."><meta data-rh="true" property="og:description" content="This document introduces how to renew and replace certificates of the corresponding components before certificates expire, taking TLS certificates between PD, TiKV, and TiDB components in the TiDB cluster as an example."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ran-huang.github.io/renew-tls-certificate"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/renew-tls-certificate" hreflang="en"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/renew-tls-certificate" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.732b35c1.css">
<link rel="preload" href="/assets/js/runtime~main.c82b2755.js" as="script">
<link rel="preload" href="/assets/js/main.1f32aa1c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">TiDB in Kubernetes</b></a><a class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a class="navbar__item navbar__link" href="/architecture">Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ran-huang/docs-tidb-operator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/">TiDB in Kubernetes</a><button aria-label="Toggle the collapsible sidebar category &#x27;TiDB in Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/get-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/prerequisites">Deploy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/restore-data-using-tidb-lightning">Migrate</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/enable-tls-for-mysql-client">Manage</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/enable-tls-for-mysql-client">Secure</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/enable-tls-for-mysql-client">Enable TLS for the MySQL Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/enable-tls-between-components">Enable TLS between TiDB Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/enable-tls-for-dm">Enable TLS for DM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/enable-tls-for-ticdc-sink">Replicate Data to TLS-enabled Downstream Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/renew-tls-certificate">Renew and Replace the TLS Certificate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/containers-run-as-non-root-user">Run Containers as a Non-root User</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/scale-a-tidb-cluster">Scale</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/upgrade-a-tidb-cluster">Upgrade</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/backup-restore-overview">Backup and Restore</a><button aria-label="Toggle the collapsible sidebar category &#x27;Backup and Restore&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/restart-a-tidb-cluster">Maintain</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/monitor-a-tidb-cluster">Monitor and Alert</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/recover-deleted-cluster">Disaster Recovery</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tips">Troubleshoot</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/faq">TiDB FAQs in Kubernetes</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Manage</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Secure</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/renew-tls-certificate">Renew and Replace the TLS Certificate</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Renew and Replace the TLS Certificate</h1><p>This document introduces how to renew and replace certificates of the corresponding components before certificates expire, taking TLS certificates between PD, TiKV, and TiDB components in the TiDB cluster as an example.</p><p>If you need to renew and replace certificates between other components in the TiDB cluster, TiDB server-side certificate, or MySQL client-side certificate, you can take similar steps to complete the operation.</p><p>The renewal and replacement operations in this document assume that the original certificates have not expired. If the original certificates expire or become invalid, to generate new certificates and restart the TiDB cluster, refer to <a href="/enable-tls-between-components">Enable TLS between TiDB components</a> or <a href="/enable-tls-for-mysql-client">Enable TLS for MySQL client</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="renew-and-replace-certificates-issued-by-the-cfssl-system">Renew and replace certificates issued by the <code>cfssl</code> system<a class="hash-link" href="#renew-and-replace-certificates-issued-by-the-cfssl-system" title="Direct link to heading">â€‹</a></h2><p>If the original TLS certificates are issued by <a href="/enable-tls-between-components#using-cfssl">the <code>cfssl</code> system</a> and the original certificates have not expired, you can renew and replace the certificates between PD, TiKV and TiDB components as follows.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="renew-and-replace-the-ca-certificate">Renew and replace the CA certificate<a class="hash-link" href="#renew-and-replace-the-ca-certificate" title="Direct link to heading">â€‹</a></h3><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If you don&#x27;t need to renew the CA certificate, you can skip the operations in this section and directly refer to <a href="#renew-and-replace-certificates-between-components">renew and replace certificates between components</a>.</p></div></div><ol><li><p>Back up the original CA certificate and key.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> ca.pem ca.old.pem </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> ca-key.pem ca-key.old.pem</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Generate the new CA certificate and key based on the configuration of the original CA certificate and certificate signing request (CSR).</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert -initca ca-csr.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssljson -bare ca -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p><strong>Note:</strong></p><p>If necessary, you can update <code>expiry</code> in the configuration file and in CSR.</p></blockquote></li><li><p>Back up the new CA certificate and key, and generate a combined CA certificate based on the original CA certificate and the new CA certificate.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> ca.pem ca.new.pem </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">mv</span><span class="token plain"> ca-key.pem ca-key.new.pem </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> ca.new.pem ca.old.pem </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ca.pem</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Update each corresponding Kubernetes Secret objects based on the combined CA certificate.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-pd-cluster-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pd-server.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pd-server-key.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.pem --dry-run</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-tikv-cluster-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tikv-server.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tikv-server-key.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.pem --dry-run</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-tidb-cluster-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb-server.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb-server-key.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.pem --dry-run</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-cluster-client-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client-key.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.pem --dry-run</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the above command, <code>${cluster_name}</code> is the name of the cluster, and <code>${namespace}</code> is the namespace in which the TiDB cluster is deployed.</p><blockquote><p><strong>Note:</strong></p><p>The above command only renews the server-side CA certificate and the client-side CA certificate between PD, TiKV, and TiDB components. If you need to renew the server-side CA certificates for other components, such as TiCDC and TiFlash, you can execute the similar command.</p></blockquote></li><li><p><a href="/restart-a-tidb-cluster">Perform the rolling restart</a> to components that need to load the combined CA certificate.</p><p>After the completion of the rolling restart, based on the combined CA certificate, each component can accept the certificate issued by either the original CA certificate or the new CA certificate at the same time.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="renew-and-replace-certificates-between-components">Renew and replace certificates between components<a class="hash-link" href="#renew-and-replace-certificates-between-components" title="Direct link to heading">â€‹</a></h3><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Before renewing and replacing certificates between components, make sure that the CA certificate can verify the certificates between components before and after the renewal as valid. If you have <a href="#renew-and-replace-the-ca-certificate">renewed and replaced the CA certificate</a>, make sure that the TiDB cluster is restarted based on the new CA certificate.</p></div></div><ol><li><p>Generate new server-side and client-side certificates based on the original configuration information of each component.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert -ca</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.new.pem -ca-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-key.new.pem -config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-config.json -profile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">internal pd-server.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssljson -bare pd-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert -ca</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.new.pem -ca-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-key.new.pem -config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-config.json -profile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">internal tikv-server.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssljson -bare tikv-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert -ca</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.new.pem -ca-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-key.new.pem -config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-config.json -profile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">internal tidb-server.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssljson -bare tidb-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfssl gencert -ca</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.new.pem -ca-key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-key.new.pem -config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca-config.json -profile</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client client.json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> cfssljson -bare client</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p><strong>Note:</strong></p><ul><li>The above command assumes that you have <a href="#renew-and-replace-the-tls-certificate">renewed and replaced the CA certificate</a> and saved the new CA certificate as <code>ca.new.pem</code> and the new key as <code>ca-key.new.pem</code>. If you have not renewed the CA certificate and the key, modify the corresponding parameters in the command to <code>ca.pem</code> and <code>ca-key.pem</code>.</li><li>The above command only generates the server-side and the client-side certificates between PD, TiKV, and TiDB components. If you need to generate the server-side CA certificates for other components, such as TiCDC and TiFlash, you can execute the similar command.</li></ul></blockquote></li><li><p>Update each corresponding Kubernetes Secret object based on the newly generated server-side and client-side certificates.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-pd-cluster-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pd-server.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pd-server-key.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.pem --dry-run</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-tikv-cluster-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tikv-server.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tikv-server-key.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.pem --dry-run</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-tidb-cluster-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb-server.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb-server-key.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.pem --dry-run</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-cluster-client-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client-key.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.pem --dry-run</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the above command, <code>${cluster_name}</code> is the name of the cluster, and <code>${namespace}</code> is the namespace in which the TiDB cluster is deployed.</p><blockquote><p><strong>Note:</strong></p><p> The above command only renews the server-side and the client-side certificate between PD, TiKV, and TiDB components. If you need to renew the server-side certificates for other components, such as TiCDC and TiFlash, you can execute the similar command.</p></blockquote></li><li><p><a href="/restart-a-tidb-cluster">Perform the rolling restart</a> to components that need to load the new certificates.</p><p>After the completion of the rolling restart, each component use the new certificate for TLS communication. If you refer to <a href="#renew-and-replace-the-ca-certificate">Renew and replace the CA certificate</a> and make each component load the combined CA certificate, each component can still accept the certificate issued by the original CA certificate.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="optional-remove-the-original-ca-certificate-from-the-combined-ca-certificate">Optional: Remove the original CA certificate from the combined CA certificate<a class="hash-link" href="#optional-remove-the-original-ca-certificate-from-the-combined-ca-certificate" title="Direct link to heading">â€‹</a></h3><p>After you <a href="#renew-and-replace-the-ca-certificate">renew and replace the combined CA certificate</a>, <a href="#renew-and-replace-certificates-between-components">server-side and client-side certificates between components</a>, you might want to remove the original CA certificate (for example, because the CA certificate has expired or the private key is compromised). To remove the original CA certificate, take steps as follows:</p><ol><li><p>Renew the Kubernetes Secret objects based on the new CA certificate.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-pd-cluster-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pd-server.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pd-server-key.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.new.pem --dry-run</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-tikv-cluster-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tikv-server.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tikv-server-key.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.new.pem --dry-run</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-tidb-cluster-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb-server.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb-server-key.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.new.pem --dry-run</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret generic </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-cluster-client-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tls.key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client-key.pem --from-file</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.crt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ca.new.pem --dry-run</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">client -o yaml </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> kubectl apply -f -</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the above command, <code>${cluster_name}</code> is the name of the cluster, and <code>${namespace}</code> is the namespace in which the TiDB cluster is deployed.</p><blockquote><p><strong>Note:</strong></p><ul><li>The above command assumes that you have <a href="#renew-and-replace-the-tls-certificate">renewed and replaced the CA certificate</a> and saved the new CA certificate as <code>ca.new.pem</code>.</li></ul></blockquote></li><li><p><a href="/restart-a-tidb-cluster">Perform the rolling restart</a> to components that need to load the new certificates.</p><p>After the completion of the rolling restart, each component can only accept the certificate issued by the new CA certificate.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="renew-and-replace-the-certificate-issued-by-cert-manager">Renew and replace the certificate issued by <code>cert-manager</code><a class="hash-link" href="#renew-and-replace-the-certificate-issued-by-cert-manager" title="Direct link to heading">â€‹</a></h2><p>If the original TLS certificate is issued by <a href="/enable-tls-between-components#using-cert-manager">the <code>cert-manager</code> system</a>, and the original certificate has not expired, the procedure varies with whether to renew the CA certificate.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="renew-and-replace-the-ca-certificate-and-certificates-between-components">Renew and replace the CA certificate and certificates between components<a class="hash-link" href="#renew-and-replace-the-ca-certificate-and-certificates-between-components" title="Direct link to heading">â€‹</a></h3><p>When you use <code>cert-manager</code> to issue the certificate, if you specify the <code>spec.renewBefore</code> of the <code>Certificate</code> resource, <code>cert-manager</code> can automatically update the certificate before it expires.</p><p>Although <code>cert-manager</code> can automatically renew the CA certificate and the corresponding Kubernetes Secret objects, it currently does not support merging the old and new CA certificates into a combined CA certificate to accept certificates issued by the new and old CA certificates at the same time. Therefore, during the process of renewing and replacing the CA certificate, the cluster components cannot authenticate each other via TLS.</p><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Warning</h5></div><div class="admonition-content"><p>Because the components cannot accept certificates issued by the new and old CAs at the same time, during the process of renewing and replacing certificates, some components&#x27; Pods need to be recreated. This might cause some requests to access the TiDB cluster to fail.</p></div></div><p>The steps to renew and replace the CA certificates of PD, TiKV, TiDB and certificates between components are as follows.</p><ol><li><p>The <code>cert-manager</code> automatically renews the CA certificate and the Kubernetes Secret object <code>${cluster_name}-ca-secret</code> before the certificate expires.</p><p><code>${cluster_name}</code> is the name of the cluster.</p><p>To manually renew the CA certificate, you can directly delete the corresponding Kubernetes Secret objects and trigger <code>cert-manager</code> to regenerate the CA certificate.</p></li><li><p>Delete the Kubernetes Secret objects corresponding to the certificate of each component.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete secret </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-pd-cluster-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete secret </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-tikv-cluster-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete secret </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-tidb-cluster-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete secret </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-cluster-client-secret --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${namespace}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the above command, <code>${cluster_name}</code> is the name of the cluster, and <code>${namespace}</code> is the namespace in which the TiDB cluster is deployed.</p></li><li><p>Wait for <code>cert-manager</code> to issue new certificates for each component based on the new CA certificate.</p><p>Observe the output of <code>kubectl get secret --namespace=${namespace}</code> until the Kubernetes Secret objects corresponding to all components are created.</p></li><li><p>Forcibly recreate the Pods of the PD, TiKV, and TiDB components in sequence.</p><p>Because <code>cert-manager</code> does not support combined CA certificates, if you try to perform a rolling update of each component, the Pods using the different CAs to issue certificates cannot communicate with each other via TLS. Therefore, you need to delete the Pods forcibly and recreate the Pods based on the certificate issued by the new CA.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -n ${namespace} pod ${pod_name}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the above command, <code>${namespace}</code> is the namespace in which the TiDB cluster is deployed, and <code>${pod_name}</code> is the Pod name of each replica of PD, TiKV, and TiDB.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="only-renew-and-replace-certificates-between-components">Only renew and replace certificates between components<a class="hash-link" href="#only-renew-and-replace-certificates-between-components" title="Direct link to heading">â€‹</a></h3><ol><li><p>The <code>cert-manager</code> automatically updates the certificate of each component and the Kubernetes Secret object before the certificate expires.</p><p>For PD, TiKV, and TiDB components, the namespace in which the TiDB cluster is deployed contains the following Kubernetes Secret objects:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">${cluster_name}-pd-cluster-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">${cluster_name}-tikv-cluster-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">${cluster_name}-tidb-cluster-secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">${cluster_name}-cluster-client-secret</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the above command, <code>${cluster_name}</code> is the name of the cluster.</p><p>If you want to manually update the certificate between components, you can directly delete the corresponding Kubernetes Secret objects and trigger <code>cert-manager</code> to regenerate the certificate between components.</p></li><li><p>For certificates between components, each component automatically reloads the new certificates when creating the new connection later.</p><blockquote><p><strong>Note:</strong></p><ul><li>Currently, each component does not support <a href="https://docs.pingcap.com/tidb/stable/enable-tls-between-components#reload-certificates" target="_blank" rel="noopener noreferrer">reload CA certificates</a> manuallyï¼Œyou need to refer to <a href="#renew-and-replace-the-ca-certificate-and-certificates-between-components">renew and replace the CA certificate and certificates between components</a>.</li><li>For the TiDB server-side certificate, you can manually reload by referring to any of the following methods:<ul><li>Refer to <a href="https://docs.pingcap.com/tidb/stable/enable-tls-between-clients-and-servers#reload-certificate-key-and-ca" target="_blank" rel="noopener noreferrer">Reload certificate, key, and CA</a>.</li><li>Refer to <a href="/restart-a-tidb-cluster">Rolling restart the TiDB Cluster</a> to perform a rolling restart of TiDB server.</li></ul></li></ul></blockquote></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/renew-tls-certificate.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/enable-tls-for-ticdc-sink"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Replicate Data to TLS-enabled Downstream Services</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/containers-run-as-non-root-user"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Run Containers as a Non-root User</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#renew-and-replace-certificates-issued-by-the-cfssl-system" class="table-of-contents__link toc-highlight">Renew and replace certificates issued by the <code>cfssl</code> system</a><ul><li><a href="#renew-and-replace-the-ca-certificate" class="table-of-contents__link toc-highlight">Renew and replace the CA certificate</a></li><li><a href="#renew-and-replace-certificates-between-components" class="table-of-contents__link toc-highlight">Renew and replace certificates between components</a></li><li><a href="#optional-remove-the-original-ca-certificate-from-the-combined-ca-certificate" class="table-of-contents__link toc-highlight">Optional: Remove the original CA certificate from the combined CA certificate</a></li></ul></li><li><a href="#renew-and-replace-the-certificate-issued-by-cert-manager" class="table-of-contents__link toc-highlight">Renew and replace the certificate issued by <code>cert-manager</code></a><ul><li><a href="#renew-and-replace-the-ca-certificate-and-certificates-between-components" class="table-of-contents__link toc-highlight">Renew and replace the CA certificate and certificates between components</a></li><li><a href="#only-renew-and-replace-certificates-between-components" class="table-of-contents__link toc-highlight">Only renew and replace certificates between components</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">User Manual</a></li><li class="footer__item"><a class="footer__link-item" href="/architecture">Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/tidb" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://tidb.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>tidb.io<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/pingcap" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/pingcap/tidb-operator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Source Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 TiDB in Kubernetes Docs, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c82b2755.js"></script>
<script src="/assets/js/main.1f32aa1c.js"></script>
</body>
</html>