"use strict";(self.webpackChunkpingcap_docs=self.webpackChunkpingcap_docs||[]).push([[9510],{3905:function(e,t,a){a.d(t,{Zo:function(){return s},kt:function(){return m}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),c=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},s=function(e){var t=c(e.components);return n.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=c(a),m=r,k=u["".concat(p,".").concat(m)]||u[m]||d[m]||i;return a?n.createElement(k,o(o({ref:t},s),{},{components:a})):n.createElement(k,o({ref:t},s))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<i;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},6945:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return c},assets:function(){return s},toc:function(){return d},default:function(){return m}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),o=["components"],l={title:"Deploy TiDB in General Kubernetes",summary:"Learn how to deploy a TiDB cluster on general Kubernetes."},p="Deploy TiDB in General Kubernetes",c={unversionedId:"deploy-on-general-kubernetes",id:"deploy-on-general-kubernetes",title:"Deploy TiDB in General Kubernetes",description:"This document describes how to deploy a TiDB cluster in general Kubernetes.",source:"@site/docs/deploy-on-general-kubernetes.md",sourceDirName:".",slug:"/deploy-on-general-kubernetes",permalink:"/deploy-on-general-kubernetes",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/deploy-on-general-kubernetes.md",tags:[],version:"current",frontMatter:{title:"Deploy TiDB in General Kubernetes",summary:"Learn how to deploy a TiDB cluster on general Kubernetes."},sidebar:"mySidebar",previous:{title:"Configure a TiDB Cluster in Kubernetes",permalink:"/configure-a-tidb-cluster"},next:{title:"Initialize a TiDB Cluster in Kubernetes",permalink:"/initialize-a-cluster"}},s={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Deploy the TiDB cluster",id:"deploy-the-tidb-cluster",level:2},{value:"Initialize the TiDB cluster",id:"initialize-the-tidb-cluster",level:2}],u={toc:d};function m(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"deploy-tidb-in-general-kubernetes"},"Deploy TiDB in General Kubernetes"),(0,i.kt)("p",null,"This document describes how to deploy a TiDB cluster in general Kubernetes."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Meet ",(0,i.kt)("a",{parentName:"li",href:"/prerequisites"},"prerequisites"),"."),(0,i.kt)("li",{parentName:"ul"},"Complete ",(0,i.kt)("a",{parentName:"li",href:"/deploy-tidb-operator"},"deploying TiDB Operator"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/configure-a-tidb-cluster"},"Configure the TiDB cluster"))),(0,i.kt)("h2",{id:"deploy-the-tidb-cluster"},"Deploy the TiDB cluster"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Create ",(0,i.kt)("inlineCode",{parentName:"p"},"Namespace"),":"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl create namespace ${namespace}\n")),(0,i.kt)("blockquote",{parentName:"li"},(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},"Note:")),(0,i.kt)("p",{parentName:"blockquote"},"A ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/"},(0,i.kt)("inlineCode",{parentName:"a"},"namespace"))," is a virtual cluster backed by the same physical cluster. You can give it a name that is easy to memorize, such as the same name as ",(0,i.kt)("inlineCode",{parentName:"p"},"cluster_name"),"."))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Deploy the TiDB cluster:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f ${cluster_name} -n ${namespace}\n")),(0,i.kt)("blockquote",{parentName:"li"},(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},"Note:")),(0,i.kt)("p",{parentName:"blockquote"},"It is recommended to organize configurations for a TiDB cluster under a directory of ",(0,i.kt)("inlineCode",{parentName:"p"},"cluster_name")," and save it as ",(0,i.kt)("inlineCode",{parentName:"p"},"${cluster_name}/tidb-cluster.yaml"),".")),(0,i.kt)("p",{parentName:"li"},"If the server does not have an external network, you need to download the Docker image used by the TiDB cluster on a machine with Internet access and upload it to the server, and then use ",(0,i.kt)("inlineCode",{parentName:"p"},"docker load")," to install the Docker image on the server."),(0,i.kt)("p",{parentName:"li"},"To deploy a TiDB cluster, you need the following Docker images (assuming the version of the TiDB cluster is v5.3.0):"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"pingcap/pd:v5.3.0\npingcap/tikv:v5.3.0\npingcap/tidb:v5.3.0\npingcap/tidb-binlog:v5.3.0\npingcap/ticdc:v5.3.0\npingcap/tiflash:v5.3.0\npingcap/tidb-monitor-reloader:v1.0.1\npingcap/tidb-monitor-initializer:v5.3.0\ngrafana/grafana:6.0.1\nprom/prometheus:v2.18.1\nbusybox:1.26.2\n")),(0,i.kt)("p",{parentName:"li"},"Next, download all these images with the following command:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"docker pull pingcap/pd:v5.3.0\ndocker pull pingcap/tikv:v5.3.0\ndocker pull pingcap/tidb:v5.3.0\ndocker pull pingcap/tidb-binlog:v5.3.0\ndocker pull pingcap/ticdc:v5.3.0\ndocker pull pingcap/tiflash:v5.3.0\ndocker pull pingcap/tidb-monitor-reloader:v1.0.1\ndocker pull pingcap/tidb-monitor-initializer:v5.3.0\ndocker pull grafana/grafana:6.0.1\ndocker pull prom/prometheus:v2.18.1\ndocker pull busybox:1.26.2\n\ndocker save -o pd-v5.3.0.tar pingcap/pd:v5.3.0\ndocker save -o tikv-v5.3.0.tar pingcap/tikv:v5.3.0\ndocker save -o tidb-v5.3.0.tar pingcap/tidb:v5.3.0\ndocker save -o tidb-binlog-v5.3.0.tar pingcap/tidb-binlog:v5.3.0\ndocker save -o ticdc-v5.3.0.tar pingcap/ticdc:v5.3.0\ndocker save -o tiflash-v5.3.0.tar pingcap/tiflash:v5.3.0\ndocker save -o tidb-monitor-reloader-v1.0.1.tar pingcap/tidb-monitor-reloader:v1.0.1\ndocker save -o tidb-monitor-initializer-v5.3.0.tar pingcap/tidb-monitor-initializer:v5.3.0\ndocker save -o grafana-6.0.1.tar grafana/grafana:6.0.1\ndocker save -o prometheus-v2.18.1.tar prom/prometheus:v2.18.1\ndocker save -o busybox-1.26.2.tar busybox:1.26.2\n")),(0,i.kt)("p",{parentName:"li"},"Next, upload these Docker images to the server, and execute ",(0,i.kt)("inlineCode",{parentName:"p"},"docker load")," to install these Docker images on the server:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"docker load -i pd-v5.3.0.tar\ndocker load -i tikv-v5.3.0.tar\ndocker load -i tidb-v5.3.0.tar\ndocker load -i tidb-binlog-v5.3.0.tar\ndocker load -i ticdc-v5.3.0.tar\ndocker load -i tiflash-v5.3.0.tar\ndocker load -i tidb-monitor-reloader-v1.0.1.tar\ndocker load -i tidb-monitor-initializer-v5.3.0.tar\ndocker load -i grafana-6.0.1.tar\ndocker load -i prometheus-v2.18.1.tar\ndocker load -i busybox-1.26.2.tar\n"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"View the Pod status:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get po -n ${namespace} -l app.kubernetes.io/instance=${cluster_name}\n")))),(0,i.kt)("p",null,"You can use TiDB Operator to deploy and manage multiple TiDB clusters in a single Kubernetes cluster by repeating the above procedure and replacing ",(0,i.kt)("inlineCode",{parentName:"p"},"cluster_name")," with a different name."),(0,i.kt)("p",null,"Different clusters can be in the same or different ",(0,i.kt)("inlineCode",{parentName:"p"},"namespace"),", which is based on your actual needs."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"If you need to deploy a TiDB cluster on ARM64 machines, refer to ",(0,i.kt)("a",{parentName:"p",href:"/deploy-cluster-on-arm64"},"Deploy a TiDB Cluster on ARM64 Machines"),"."))),(0,i.kt)("h2",{id:"initialize-the-tidb-cluster"},"Initialize the TiDB cluster"),(0,i.kt)("p",null,"If you want to initialize your cluster after deployment, refer to ",(0,i.kt)("a",{parentName:"p",href:"/initialize-a-cluster"},"Initialize a TiDB Cluster in Kubernetes"),"."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"By default, TiDB (starting from v4.0.2) periodically shares usage details with PingCAP to help understand how to improve the product. For details about what is shared and how to disable the sharing, see ",(0,i.kt)("a",{parentName:"p",href:"https://docs.pingcap.com/tidb/stable/telemetry"},"Telemetry"),"."))))}m.isMDXComponent=!0}}]);