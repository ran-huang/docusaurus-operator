"use strict";(self.webpackChunkpingcap_docs=self.webpackChunkpingcap_docs||[]).push([[6879],{3905:function(e,n,t){t.d(n,{Zo:function(){return m},kt:function(){return d}});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var u=r.createContext({}),l=function(e){var n=r.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},m=function(e){var n=l(e.components);return r.createElement(u.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},f=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,u=e.parentName,m=c(e,["components","mdxType","originalType","parentName"]),f=l(t),d=o,p=f["".concat(u,".").concat(d)]||f[d]||s[d]||i;return t?r.createElement(p,a(a({ref:n},m),{},{components:t})):r.createElement(p,a({ref:n},m))}));function d(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,a=new Array(i);a[0]=f;var c={};for(var u in n)hasOwnProperty.call(n,u)&&(c[u]=n[u]);c.originalType=e,c.mdxType="string"==typeof e?e:o,a[1]=c;for(var l=2;l<i;l++)a[l]=t[l];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}f.displayName="MDXCreateElement"},3479:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return c},contentTitle:function(){return u},metadata:function(){return l},assets:function(){return m},toc:function(){return s},default:function(){return d}});var r=t(7462),o=t(3366),i=(t(7294),t(3905)),a=["components"],c={title:"Enable Dynamic Configuration for TidbMonitor",summary:"This document describes how to enable dynamic configuration for TidbMonitor.",aliases:["/tidb-in-kubernetes/dev/enable-dynamic-configuration-for-tidbmonitor"]},u="Enable Dynamic Configuration for TidbMonitor",l={unversionedId:"enable-monitor-dynamic-configuration",id:"enable-monitor-dynamic-configuration",title:"Enable Dynamic Configuration for TidbMonitor",description:"This document describes how to enable dynamic configuration for TidbMonitor.",source:"@site/docs/enable-monitor-dynamic-configuration.md",sourceDirName:".",slug:"/enable-monitor-dynamic-configuration",permalink:"/enable-monitor-dynamic-configuration",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/enable-monitor-dynamic-configuration.md",tags:[],version:"current",frontMatter:{title:"Enable Dynamic Configuration for TidbMonitor",summary:"This document describes how to enable dynamic configuration for TidbMonitor.",aliases:["/tidb-in-kubernetes/dev/enable-dynamic-configuration-for-tidbmonitor"]},sidebar:"mySidebar",previous:{title:"Aggregate Monitoring Data of Multiple TiDB Clusters",permalink:"/aggregate-multiple-cluster-monitor-data"},next:{title:"Enable Shards for TidbMonitor",permalink:"/enable-monitor-shards"}},m={},s=[{value:"Enable the dynamic configuration feature",id:"enable-the-dynamic-configuration-feature",level:2},{value:"Disable the dynamic configuration feature",id:"disable-the-dynamic-configuration-feature",level:2}],f={toc:s};function d(e){var n=e.components,t=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},f,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"enable-dynamic-configuration-for-tidbmonitor"},"Enable Dynamic Configuration for TidbMonitor"),(0,i.kt)("p",null,"This document describes how to enable dynamic configuration for TidbMonitor."),(0,i.kt)("p",null,"TidbMonitor supports monitoring across multiple clusters and shards. Without dynamic configuration, when the Prometheus configurations, rules, or targets are changed, such changes only take effect after a restart. If you are monitoring a large dataset, after the restart, it might take a long time to recover the Prometheus snapshot data."),(0,i.kt)("p",null,"With dynamic configuration enabled, any configuration change of TidbMonitor takes effect immediately."),(0,i.kt)("h2",{id:"enable-the-dynamic-configuration-feature"},"Enable the dynamic configuration feature"),(0,i.kt)("p",null,"To enable the dynamic configuration feature, configure ",(0,i.kt)("inlineCode",{parentName:"p"},"prometheusReloader")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"spec")," field of TidbMonitor. For example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: pingcap.com/v1alpha1\nkind: TidbMonitor\nmetadata:\n  name: monitor\nspec:\n  clusterScoped: true\n  clusters:\n    - name: ns1\n      namespace: ns1\n    - name: ns2\n      namespace: ns2\n  prometheusReloader:\n    baseImage: quay.io/prometheus-operator/prometheus-config-reloader\n    version: v0.49.0\n  imagePullPolicy: IfNotPresent\n")),(0,i.kt)("p",null,"After you modify the ",(0,i.kt)("inlineCode",{parentName:"p"},"prometheusReloader")," configuration, TidbMonitor restarts automatically. After the restart, the dynamic configuration feature is enabled. All configuration changes related to Prometheus are dynamically updated."),(0,i.kt)("p",null,"For more examples, refer to ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/pingcap/tidb-operator/tree/master/examples/monitor-dynamic-configmap"},"monitor-dynamic-configmap"),"."),(0,i.kt)("h2",{id:"disable-the-dynamic-configuration-feature"},"Disable the dynamic configuration feature"),(0,i.kt)("p",null,"To disable the dynamic configuration feature, remove the ",(0,i.kt)("inlineCode",{parentName:"p"},"prometheusReloader")," configuration from the ",(0,i.kt)("inlineCode",{parentName:"p"},"spec")," field of TidbMonitor."))}d.isMDXComponent=!0}}]);