"use strict";(self.webpackChunkpingcap_docs=self.webpackChunkpingcap_docs||[]).push([[836],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(n),h=o,m=d["".concat(l,".").concat(h)]||d[h]||c[h]||a;return n?r.createElement(m,i(i({ref:t},p),{},{components:n})):r.createElement(m,i({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var u=2;u<a;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3584:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return u},assets:function(){return p},toc:function(){return c},default:function(){return h}});var r=n(7462),o=n(3366),a=(n(7294),n(3905)),i=["components"],s={title:"TiDB FAQs in Kubernetes",summary:"Learn about TiDB FAQs in Kubernetes."},l="TiDB FAQs in Kubernetes",u={unversionedId:"faq",id:"faq",title:"TiDB FAQs in Kubernetes",description:"This document collects frequently asked questions (FAQs) about the TiDB cluster in Kubernetes.",source:"@site/docs/faq.md",sourceDirName:".",slug:"/faq",permalink:"/faq",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/faq.md",tags:[],version:"current",frontMatter:{title:"TiDB FAQs in Kubernetes",summary:"Learn about TiDB FAQs in Kubernetes."},sidebar:"mySidebar",previous:{title:"Common Network Issues of TiDB in Kubernetes",permalink:"/network-issues"}},p={},c=[{value:"How to modify time zone settings\uff1f",id:"how-to-modify-time-zone-settings",level:2},{value:"For the first deployment",id:"for-the-first-deployment",level:3},{value:"For a running cluster",id:"for-a-running-cluster",level:3},{value:"Can HPA or VPA be configured on TiDB components?",id:"can-hpa-or-vpa-be-configured-on-tidb-components",level:2},{value:"What scenarios require manual intervention when I use TiDB Operator to orchestrate a TiDB cluster?",id:"what-scenarios-require-manual-intervention-when-i-use-tidb-operator-to-orchestrate-a-tidb-cluster",level:2},{value:"What is the recommended deployment topology when I use TiDB Operator to orchestrate a TiDB cluster on a public cloud?",id:"what-is-the-recommended-deployment-topology-when-i-use-tidb-operator-to-orchestrate-a-tidb-cluster-on-a-public-cloud",level:2},{value:"Does TiDB Operator support TiSpark?",id:"does-tidb-operator-support-tispark",level:2},{value:"How to check the configuration of the TiDB cluster?",id:"how-to-check-the-configuration-of-the-tidb-cluster",level:2},{value:"Why does TiDB Operator fail to schedule Pods when I deploy the TiDB clusters?",id:"why-does-tidb-operator-fail-to-schedule-pods-when-i-deploy-the-tidb-clusters",level:2},{value:"How does TiDB ensure data safety and reliability?",id:"how-does-tidb-ensure-data-safety-and-reliability",level:2}],d={toc:c};function h(e){var t=e.components,n=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"tidb-faqs-in-kubernetes"},"TiDB FAQs in Kubernetes"),(0,a.kt)("p",null,"This document collects frequently asked questions (FAQs) about the TiDB cluster in Kubernetes."),(0,a.kt)("h2",{id:"how-to-modify-time-zone-settings"},"How to modify time zone settings\uff1f"),(0,a.kt)("p",null,"The default time zone setting for each component container of a TiDB cluster in Kubernetes is UTC. To modify this setting, take the steps below based on your cluster status:"),(0,a.kt)("h3",{id:"for-the-first-deployment"},"For the first deployment"),(0,a.kt)("p",null,"Configure the ",(0,a.kt)("inlineCode",{parentName:"p"},".spec.timezone")," attribute in the TidbCluster CR. For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"...\nspec:\n  timezone: Asia/Shanghai\n...\n")),(0,a.kt)("p",null,"Then deploy the TiDB cluster."),(0,a.kt)("h3",{id:"for-a-running-cluster"},"For a running cluster"),(0,a.kt)("p",null,"If the TiDB cluster is already running, first upgrade the cluster, and then configure it to support the new time zone."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Upgrade the TiDB cluster:"),(0,a.kt)("p",{parentName:"li"},"Configure the ",(0,a.kt)("inlineCode",{parentName:"p"},".spec.timezone")," attribute in the TidbCluster CR. For example:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"...\nspec:\n  timezone: Asia/Shanghai\n...\n")),(0,a.kt)("p",{parentName:"li"},"Then upgrade the TiDB cluster.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Configure TiDB to support the new time zone:"),(0,a.kt)("p",{parentName:"li"},"Refer to ",(0,a.kt)("a",{parentName:"p",href:"https://docs.pingcap.com/tidb/v4.0/configure-time-zone"},"Time Zone Support")," to modify TiDB service time zone settings."))),(0,a.kt)("h2",{id:"can-hpa-or-vpa-be-configured-on-tidb-components"},"Can HPA or VPA be configured on TiDB components?"),(0,a.kt)("p",null,"Currently, the TiDB cluster does not support HPA (Horizontal Pod Autoscaling) or VPA (Vertical Pod Autoscaling), because it is difficult to achieve autoscaling on stateful applications such as a database. Autoscaling can not be achieved merely by the monitoring data of CPU and memory."),(0,a.kt)("h2",{id:"what-scenarios-require-manual-intervention-when-i-use-tidb-operator-to-orchestrate-a-tidb-cluster"},"What scenarios require manual intervention when I use TiDB Operator to orchestrate a TiDB cluster?"),(0,a.kt)("p",null,"Besides the operation of the Kubernetes cluster itself, there are the following two scenarios that might require manual intervention when using TiDB Operator:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Adjusting the cluster after the auto-failover of TiKV. See ",(0,a.kt)("a",{parentName:"li",href:"/use-auto-failover"},"Auto-Failover")," for details;"),(0,a.kt)("li",{parentName:"ul"},"Maintaining or dropping the specified Kubernetes nodes. See ",(0,a.kt)("a",{parentName:"li",href:"/maintain-a-kubernetes-node"},"Maintaining Nodes")," for details.")),(0,a.kt)("h2",{id:"what-is-the-recommended-deployment-topology-when-i-use-tidb-operator-to-orchestrate-a-tidb-cluster-on-a-public-cloud"},"What is the recommended deployment topology when I use TiDB Operator to orchestrate a TiDB cluster on a public cloud?"),(0,a.kt)("p",null,"To achieve high availability and data safety, it is recommended that you deploy the TiDB cluster in at least three availability zones in a production environment."),(0,a.kt)("p",null,"In terms of the deployment topology relationship between the TiDB cluster and TiDB services, TiDB Operator supports the following three deployment modes. Each mode has its own merits and demerits, so your choice must be based on actual application needs."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Deploy the TiDB cluster and TiDB services in the same Kubernetes cluster of the same VPC;"),(0,a.kt)("li",{parentName:"ul"},"Deploy the TiDB cluster and TiDB services in different Kubernetes clusters of the same VPC;"),(0,a.kt)("li",{parentName:"ul"},"Deploy the TiDB cluster and TiDB services in different Kubernetes clusters of different VPCs.")),(0,a.kt)("h2",{id:"does-tidb-operator-support-tispark"},"Does TiDB Operator support TiSpark?"),(0,a.kt)("p",null,"TiDB Operator does not yet support automatically orchestrating TiSpark."),(0,a.kt)("p",null,"If you want to add the TiSpark component to TiDB in Kubernetes, you must maintain Spark on your own in ",(0,a.kt)("strong",{parentName:"p"},"the same")," Kubernetes cluster. You must ensure that Spark can access the IPs and ports of PD and TiKV instances, and install the TiSpark plugin for Spark. ",(0,a.kt)("a",{parentName:"p",href:"https://pingcap.com/docs/stable/tispark-overview/#deploy-tispark-on-the-existing-spark-cluster"},"TiSpark")," offers a detailed guide for you to install the TiSpark plugin."),(0,a.kt)("p",null,"To maintain Spark in Kubernetes, refer to ",(0,a.kt)("a",{parentName:"p",href:"http://spark.apache.org/docs/latest/running-on-kubernetes.html"},"Spark on Kubernetes"),"."),(0,a.kt)("h2",{id:"how-to-check-the-configuration-of-the-tidb-cluster"},"How to check the configuration of the TiDB cluster?"),(0,a.kt)("p",null,"To check the configuration of the PD, TiKV, and TiDB components of the current cluster, run the following command:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Check the PD configuration file:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl exec -it ${pod_name} -n ${namespace} -- cat /etc/pd/pd.toml\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Check the TiKV configuration file:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl exec -it ${pod_name} -n ${namespace} -- cat /etc/tikv/tikv.toml\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Check the TiDB configuration file:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl exec -it ${pod_name} -c tidb -n ${namespace} -- cat /etc/tidb/tidb.toml\n")))),(0,a.kt)("h2",{id:"why-does-tidb-operator-fail-to-schedule-pods-when-i-deploy-the-tidb-clusters"},"Why does TiDB Operator fail to schedule Pods when I deploy the TiDB clusters?"),(0,a.kt)("p",null,"Three possible reasons:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Insufficient resource or HA Policy causes the Pod stuck in the ",(0,a.kt)("inlineCode",{parentName:"p"},"Pending")," state. Refer to ",(0,a.kt)("a",{parentName:"p",href:"/deploy-failures#the-pod-is-in-the-pending-state"},"Deployment Failures")," for more details.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("inlineCode",{parentName:"p"},"taint")," is applied to some nodes, which prevents the Pod from being scheduled to these nodes unless the Pod has the matching ",(0,a.kt)("inlineCode",{parentName:"p"},"toleration"),". Refer to ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/"},"taint & toleration")," for more details.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Scheduling conflict, which causes the Pod stuck in the ",(0,a.kt)("inlineCode",{parentName:"p"},"ContainerCreating")," state. In such cases, you can check if there is more than one TiDB Operator deployed in the Kubernetes cluster. Conflicts occur when custom schedulers in multiple TiDB Operators schedule the same Pod in different phases."),(0,a.kt)("p",{parentName:"li"},"  You can execute the following command to verify whether there is more than one TiDB Operator deployed. If more than one record is returned, delete the extra TiDB Operator to resolve the scheduling conflict."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get deployment --all-namespaces | grep tidb-scheduler\n")))),(0,a.kt)("h2",{id:"how-does-tidb-ensure-data-safety-and-reliability"},"How does TiDB ensure data safety and reliability?"),(0,a.kt)("p",null,"To ensure persistent storage of data, TiDB clusters deployed by TiDB Operator use ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/storage/persistent-volumes/"},"Persistent Volume")," provided by Kubernetes cluster as the storage."),(0,a.kt)("p",null,"To ensure data safety in case one node is down, PD and TiKV use ",(0,a.kt)("a",{parentName:"p",href:"https://raft.github.io/"},"Raft Consistency Algorithm")," to replicate the stored data as multiple replicas across nodes."),(0,a.kt)("p",null,"In the bottom layer, TiKV replicates data using the log replication and State Machine model. For write requests, data is written to the Leader node first, and then the Leader node replicates the command to its Follower nodes as a log. When most of the Follower nodes in the cluster receive this log from the Leader node, the log is committed and the State Machine changes accordingly."))}h.isMDXComponent=!0}}]);