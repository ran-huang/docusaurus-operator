"use strict";(self.webpackChunkpingcap_docs=self.webpackChunkpingcap_docs||[]).push([[2226],{3905:function(e,t,n){n.d(t,{Zo:function(){return l},kt:function(){return p}});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=i.createContext({}),s=function(e){var t=i.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},l=function(e){var t=s(e.components);return i.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},f=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,l=u(e,["components","mdxType","originalType","parentName"]),f=s(n),p=o,m=f["".concat(c,".").concat(p)]||f[p]||d[p]||r;return n?i.createElement(m,a(a({ref:t},l),{},{components:n})):i.createElement(m,a({ref:t},l))}));function p(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,a=new Array(r);a[0]=f;var u={};for(var c in t)hasOwnProperty.call(t,c)&&(u[c]=t[c]);u.originalType=e,u.mdxType="string"==typeof e?e:o,a[1]=u;for(var s=2;s<r;s++)a[s]=n[s];return i.createElement.apply(null,a)}return i.createElement.apply(null,n)}f.displayName="MDXCreateElement"},5431:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return u},contentTitle:function(){return c},metadata:function(){return s},assets:function(){return l},toc:function(){return d},default:function(){return p}});var i=n(7462),o=n(3366),r=(n(7294),n(3905)),a=["components"],u={title:"Modify TiDB Cluster Configuration",summary:"Learn how to modify the configuration of TiDB clusters deployed in Kubernetes."},c="Modify TiDB Cluster Configuration",s={unversionedId:"modify-tidb-configuration",id:"modify-tidb-configuration",title:"Modify TiDB Cluster Configuration",description:"For a TiDB cluster, you can update the configuration of components online using SQL statements, including TiDB, TiKV, and PD, without restarting the cluster components. However, for TiDB clusters deployed in Kubernetes, after you upgrade or restart the cluster, the configurations updated using SQL statements will be overwritten by those in the TidbCluster CR. This leads to the online configuration update being invalid.",source:"@site/docs/modify-tidb-configuration.md",sourceDirName:".",slug:"/modify-tidb-configuration",permalink:"/modify-tidb-configuration",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/modify-tidb-configuration.md",tags:[],version:"current",frontMatter:{title:"Modify TiDB Cluster Configuration",summary:"Learn how to modify the configuration of TiDB clusters deployed in Kubernetes."},sidebar:"mySidebar",previous:{title:"View TiDB Logs in Kubernetes",permalink:"/view-logs"},next:{title:"Automatic Failover",permalink:"/use-auto-failover"}},l={},d=[{value:"Modify configuration for TiDB, TiKV, and other components",id:"modify-configuration-for-tidb-tikv-and-other-components",level:2},{value:"Modify PD configuration",id:"modify-pd-configuration",level:2}],f={toc:d};function p(e){var t=e.components,n=(0,o.Z)(e,a);return(0,r.kt)("wrapper",(0,i.Z)({},f,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"modify-tidb-cluster-configuration"},"Modify TiDB Cluster Configuration"),(0,r.kt)("p",null,"For a TiDB cluster, you can ",(0,r.kt)("a",{parentName:"p",href:"https://docs.pingcap.com/tidb/stable/dynamic-config/"},"update the configuration of components")," online using SQL statements, including TiDB, TiKV, and PD, without restarting the cluster components. However, for TiDB clusters deployed in Kubernetes, after you upgrade or restart the cluster, the configurations updated using SQL statements will be overwritten by those in the ",(0,r.kt)("inlineCode",{parentName:"p"},"TidbCluster")," CR. This leads to the online configuration update being invalid."),(0,r.kt)("p",null,"This document describes how to modify the configuration of TiDB clusters deployed in Kubernetes. Due to the special nature of PD, you need to separately modify the configuration of PD and other components."),(0,r.kt)("h2",{id:"modify-configuration-for-tidb-tikv-and-other-components"},"Modify configuration for TiDB, TiKV, and other components"),(0,r.kt)("p",null,"For TiDB and TiKV, if you ",(0,r.kt)("a",{parentName:"p",href:"https://docs.pingcap.com/tidb/stable/dynamic-config/"},"modify their configuration online")," using SQL statements, after you upgrade or restart the cluster, the configurations will be overwritten by those in the ",(0,r.kt)("inlineCode",{parentName:"p"},"TidbCluster")," CR. This leads to the online configuration update being invalid. Therefore, to persist the configuration, you must directly modify their configurations in the ",(0,r.kt)("inlineCode",{parentName:"p"},"TidbCluster")," CR."),(0,r.kt)("p",null,"For TiFlash, TiCDC, and Pump, you can only modify their configurations in the ",(0,r.kt)("inlineCode",{parentName:"p"},"TidbCluster")," CR."),(0,r.kt)("p",null,"To modify the configuration in the ",(0,r.kt)("inlineCode",{parentName:"p"},"TidbCluster")," CR, take the following steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Refer to the parameters in ",(0,r.kt)("a",{parentName:"p",href:"/configure-a-tidb-cluster#configure-tidb-components"},"Configure TiDB components")," to modify the component configuration in the ",(0,r.kt)("inlineCode",{parentName:"p"},"TidbCluster")," CR:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl edit tc ${cluster_name} -n ${namespace}\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"After the configuration is modified, view the updating progress:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"watch kubectl -n ${namespace} get pod -o wide\n")),(0,r.kt)("p",{parentName:"li"},"After all the Pods are recreated and are in the ",(0,r.kt)("inlineCode",{parentName:"p"},"Running")," state, the configuration is successfully modified."))),(0,r.kt)("h2",{id:"modify-pd-configuration"},"Modify PD configuration"),(0,r.kt)("p",null,"After PD is started for the first time, some PD configuration items are persisted in etcd. The persisted configuration in etcd takes precedence over the configuration file in PD. Therefore, after the first start, you cannot modify some PD configuration by using the ",(0,r.kt)("inlineCode",{parentName:"p"},"TidbCluster")," CR."),(0,r.kt)("p",null,"Among all the PD configuration items listed in ",(0,r.kt)("a",{parentName:"p",href:"https://docs.pingcap.com/tidb/stable/dynamic-config/#modify-pd-configuration-online"},"Modify PD configuration online"),", after the first start, only ",(0,r.kt)("inlineCode",{parentName:"p"},"log.level")," can be modified by using the ",(0,r.kt)("inlineCode",{parentName:"p"},"TidbCluster")," CR. Other configurations cannot be modified by using CR."),(0,r.kt)("p",null,"For TiDB clusters deployed in Kubernetes, if you need to modify the PD configuration, you can modify the configuration online using ",(0,r.kt)("a",{parentName:"p",href:"https://docs.pingcap.com/tidb/stable/dynamic-config/#modify-pd-configuration-online"},"SQL statements"),", ",(0,r.kt)("a",{parentName:"p",href:"https://docs.pingcap.com/tidb/dev/pd-control/#config-show--set-option-value--placement-rules"},"pd-ctl"),", or PD server API."))}p.isMDXComponent=!0}}]);