"use strict";(self.webpackChunkpingcap_docs=self.webpackChunkpingcap_docs||[]).push([[9852],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),u=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(o.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(n),m=r,k=d["".concat(o,".").concat(m)]||d[m]||p[m]||i;return n?a.createElement(k,l(l({ref:t},c),{},{components:n})):a.createElement(k,l({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=d;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:r,l[1]=s;for(var u=2;u<i;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2018:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return u},metadata:function(){return c},assets:function(){return p},toc:function(){return d},default:function(){return h}});var a,r=n(7462),i=n(3366),l=(n(7294),n(3905)),s=["components"],o={title:"Get Started With TiDB Operator in Kubernetes",summary:"Learn how to quickly deploy a TiDB cluster in Kubernetes using TiDB Operator."},u="Get Started with TiDB Operator in Kubernetes",c={unversionedId:"get-started",id:"get-started",title:"Get Started With TiDB Operator in Kubernetes",description:"This document introduces how to create a simple Kubernetes cluster and use it to deploy a basic test TiDB cluster using TiDB Operator.",source:"@site/docs/get-started.md",sourceDirName:".",slug:"/get-started",permalink:"/get-started",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/get-started.md",tags:[],version:"current",frontMatter:{title:"Get Started With TiDB Operator in Kubernetes",summary:"Learn how to quickly deploy a TiDB cluster in Kubernetes using TiDB Operator."},sidebar:"mySidebar",previous:{title:"What's New in TiDB Operator 1.3",permalink:"/whats-new-in-v1.3"},next:{title:"Prerequisites for TiDB in Kubernetes",permalink:"/prerequisites"}},p={},d=[{value:"Step 1. Create a test Kubernetes cluster",id:"step-1-create-a-test-kubernetes-cluster",level:2},{value:"Create a Kubernetes cluster using kind",id:"create-a-kubernetes-cluster-using-kind",level:3},{value:"Create a Kubernetes cluster using minikube",id:"create-a-kubernetes-cluster-using-minikube",level:3},{value:"Start a minikube Kubernetes cluster",id:"start-a-minikube-kubernetes-cluster",level:4},{value:"Use <code>kubectl</code> to interact with the cluster",id:"use-kubectl-to-interact-with-the-cluster",level:4},{value:"Step 2. Deploy TiDB Operator",id:"step-2-deploy-tidb-operator",level:2},{value:"Install TiDB Operator CRDs",id:"install-tidb-operator-crds",level:3},{value:"Install TiDB Operator",id:"install-tidb-operator",level:3},{value:"Step 3. Deploy a TiDB cluster and its monitoring services",id:"step-3-deploy-a-tidb-cluster-and-its-monitoring-services",level:2},{value:"Deploy a TiDB cluster",id:"deploy-a-tidb-cluster",level:3},{value:"Deploy TiDB monitoring services",id:"deploy-tidb-monitoring-services",level:3},{value:"View the Pod status",id:"view-the-pod-status",level:3},{value:"Step 4. Connect to TiDB",id:"step-4-connect-to-tidb",level:2},{value:"Install the MySQL client",id:"install-the-mysql-client",level:3},{value:"Forward port 4000",id:"forward-port-4000",level:3},{value:"Connect to the TiDB service",id:"connect-to-the-tidb-service",level:3},{value:"Access the Grafana dashboard",id:"access-the-grafana-dashboard",level:3},{value:"Step 5. Upgrade a TiDB cluster",id:"step-5-upgrade-a-tidb-cluster",level:2},{value:"Modify the TiDB cluster version",id:"modify-the-tidb-cluster-version",level:3},{value:"Wait for Pods to restart",id:"wait-for-pods-to-restart",level:3},{value:"Forward the TiDB service port",id:"forward-the-tidb-service-port",level:3},{value:"Check the TiDB cluster version",id:"check-the-tidb-cluster-version",level:3},{value:"Step 6. Destroy the TiDB cluster and the Kubernetes cluster",id:"step-6-destroy-the-tidb-cluster-and-the-kubernetes-cluster",level:2},{value:"Destroy the TiDB cluster",id:"destroy-the-tidb-cluster",level:3},{value:"Stop <code>kubectl</code> port forwarding",id:"stop-kubectl-port-forwarding",level:4},{value:"Delete the TiDB cluster",id:"delete-the-tidb-cluster",level:4},{value:"Delete TiDB monitoring services",id:"delete-tidb-monitoring-services",level:4},{value:"Delete PV data",id:"delete-pv-data",level:4},{value:"Delete namespaces",id:"delete-namespaces",level:4},{value:"Destroy the Kubernetes cluster",id:"destroy-the-kubernetes-cluster",level:3},{value:"See also",id:"see-also",level:2}],m=(a="SimpleTab",function(e){return console.warn("Component "+a+" was not imported, exported, or provided by MDXProvider as global scope"),(0,l.kt)("div",e)}),k={toc:d};function h(e){var t=e.components,n=(0,i.Z)(e,s);return(0,l.kt)("wrapper",(0,r.Z)({},k,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"get-started-with-tidb-operator-in-kubernetes"},"Get Started with TiDB Operator in Kubernetes"),(0,l.kt)("p",null,"This document introduces how to create a simple Kubernetes cluster and use it to deploy a basic test TiDB cluster using TiDB Operator."),(0,l.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Warning")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"This document is for demonstration purposes only. ",(0,l.kt)("strong",{parentName:"p"},"Do not")," follow it in production environments. For deployment in production environments, see the instructions in ",(0,l.kt)("a",{parentName:"p",href:"#see-also"},"See also"),"."))),(0,l.kt)("p",null,"You can follow these steps to deploy TiDB Operator and a TiDB cluster:"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("a",{parentName:"li",href:"#step-1-create-a-test-kubernetes-cluster"},"Create a test Kubernetes cluster")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("a",{parentName:"li",href:"#step-2-deploy-tidb-operator"},"Deploy TiDB Operator")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("a",{parentName:"li",href:"#step-3-deploy-a-tidb-cluster-and-its-monitoring-services"},"Deploy a TiDB cluster and its monitoring services")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("a",{parentName:"li",href:"#step-4-connect-to-tidb"},"Connect to a TiDB cluster")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("a",{parentName:"li",href:"#step-5-upgrade-a-tidb-cluster"},"Upgrade a TiDB cluster")),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("a",{parentName:"li",href:"#step-6-destroy-the-tidb-cluster-and-the-kubernetes-cluster"},"Destroy the TiDB cluster and the Kubernetes cluster"))),(0,l.kt)("h2",{id:"step-1-create-a-test-kubernetes-cluster"},"Step 1. Create a test Kubernetes cluster"),(0,l.kt)("p",null,"This section describes two ways to create a simple Kubernetes cluster. After creating a Kubernetes cluster, you can use it to test TiDB clusters managed by TiDB Operator. Choose whichever best matches your environment."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#create-a-kubernetes-cluster-using-kind"},"Use kind")," to deploy a Kubernetes cluster in Docker. It is a common and recommended way."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#create-a-kubernetes-cluster-using-minikube"},"Use minikube")," to deploy a Kubernetes cluster running locally in a VM.")),(0,l.kt)("p",null,"Alternatively, you can deploy a Kubernetes cluster in Google Kubernetes Engine in Google Cloud Platform using the ",(0,l.kt)("a",{parentName:"p",href:"https://console.cloud.google.com/cloudshell/open?cloudshell_git_repo=https://github.com/pingcap/docs-tidb-operator&cloudshell_tutorial=en/deploy-tidb-from-kubernetes-gke.md"},"Google Cloud Shell"),"."),(0,l.kt)(m,{mdxType:"SimpleTab"},(0,l.kt)("div",{label:"kind"},(0,l.kt)("h3",{id:"create-a-kubernetes-cluster-using-kind"},"Create a Kubernetes cluster using kind"),(0,l.kt)("p",null,"This section shows how to deploy a Kubernetes cluster using ",(0,l.kt)("a",{parentName:"p",href:"https://kind.sigs.k8s.io/"},"kind"),"."),(0,l.kt)("p",null,"kind is a popular tool for running local Kubernetes clusters using Docker containers as cluster nodes. For available tags, see ",(0,l.kt)("a",{parentName:"p",href:"https://hub.docker.com/r/kindest/node/tags"},"Docker Hub"),". The latest version of kind is used by default."),(0,l.kt)("p",null,"Before deployment, make sure the following requirements are satisfied:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://docs.docker.com/install/"},"Docker"),": version >= 17.03"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl/"},"kubectl"),": version >= 1.12"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://kind.sigs.k8s.io/docs/user/quick-start/"},"kind"),": version >= 0.8.0"),(0,l.kt)("li",{parentName:"ul"},"For Linux, the value of the sysctl parameter ",(0,l.kt)("a",{parentName:"li",href:"https://linuxconfig.org/how-to-turn-on-off-ip-forwarding-in-linux"},"net.ipv4.ip_forward")," should be set to ",(0,l.kt)("inlineCode",{parentName:"li"},"1"),".")),(0,l.kt)("p",null,"The following is an example of using ",(0,l.kt)("inlineCode",{parentName:"p"},"kind")," v0.8.1:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kind create cluster\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'Creating cluster "kind" ...\n \u2713 Ensuring node image (kindest/node:v1.18.2) \ud83d\uddbc\n \u2713 Preparing nodes \ud83d\udce6\n \u2713 Writing configuration \ud83d\udcdc\n \u2713 Starting control-plane \ud83d\udd79\ufe0f\n \u2713 Installing CNI \ud83d\udd0c\n \u2713 Installing StorageClass \ud83d\udcbe\nSet kubectl context to "kind-kind"\nYou can now use your cluster with:\n\nkubectl cluster-info --context kind-kind\n\nThanks for using kind! \ud83d\ude0a\n'))),(0,l.kt)("p",null,"Check whether the cluster is successfully created:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl cluster-info\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"Kubernetes master is running at https://127.0.0.1:51026\nKubeDNS is running at https://127.0.0.1:51026/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\nTo further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.\n"))),(0,l.kt)("p",null,"You are now ready to deploy TiDB Operator.")),(0,l.kt)("div",{label:"minikube"},(0,l.kt)("h3",{id:"create-a-kubernetes-cluster-using-minikube"},"Create a Kubernetes cluster using minikube"),(0,l.kt)("p",null,"You can create a Kubernetes cluster in a VM using ",(0,l.kt)("a",{parentName:"p",href:"https://minikube.sigs.k8s.io/docs/start/"},"minikube"),", which supports macOS, Linux, and Windows."),(0,l.kt)("p",null,"Before deployment, make sure the following requirements are satisfied:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://minikube.sigs.k8s.io/docs/start/"},"minikube"),": version 1.0.0 or later versions. Newer versions like v1.24 is recommended. minikube requires a compatible hypervisor. For details, refer to minikube installation instructions."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/tasks/tools/install-kubectl/"},"kubectl"),": version >= 1.12")),(0,l.kt)("h4",{id:"start-a-minikube-kubernetes-cluster"},"Start a minikube Kubernetes cluster"),(0,l.kt)("p",null,"After minikube is installed, run the following command to start a minikube Kubernetes cluster:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"minikube start\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),"You should see output like this, with some differences depending on your OS and hypervisor:",(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'\ud83d\ude04  minikube v1.24.0 on Darwin 12.1\n\u2728  Automatically selected the docker driver. Other choices: hyperkit, virtualbox, ssh\n\ud83d\udc4d  Starting control plane node minikube in cluster minikube\n\ud83d\ude9c  Pulling base image ...\n\ud83d\udcbe  Downloading Kubernetes v1.22.3 preload ...\n    > gcr.io/k8s-minikube/kicbase: 355.78 MiB / 355.78 MiB  100.00% 4.46 MiB p/\n    > preloaded-images-k8s-v13-v1...: 501.73 MiB / 501.73 MiB  100.00% 5.18 MiB\n\ud83d\udd25  Creating docker container (CPUs=2, Memory=1985MB) ...\n\ud83d\udc33  Preparing Kubernetes v1.22.3 on Docker 20.10.8 ...\n    \u25aa Generating certificates and keys ...\n    \u25aa Booting up control plane ...\n    \u25aa Configuring RBAC rules ...\n\ud83d\udd0e  Verifying Kubernetes components...\n    \u25aa Using image gcr.io/k8s-minikube/storage-provisioner:v5\n\ud83c\udf1f  Enabled addons: storage-provisioner, default-storageclass\n\ud83c\udfc4  Done! kubectl is now configured to use "minikube" cluster and "default" namespace by default\n'))),(0,l.kt)("h4",{id:"use-kubectl-to-interact-with-the-cluster"},"Use ",(0,l.kt)("inlineCode",{parentName:"h4"},"kubectl")," to interact with the cluster"),(0,l.kt)("p",null,"To interact with the cluster, you can use ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl"),", which is included as a sub-command in ",(0,l.kt)("inlineCode",{parentName:"p"},"minikube"),". To make the ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl")," command available, you can either add the following alias definition command to your shell profile, or run the following alias definition command after opening a new shell."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"alias kubectl='minikube kubectl --'\n")),(0,l.kt)("p",null,"Run the following command to check the status of Kubernetes and ensure that ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl")," can connect to it:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"kubectl cluster-info\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"Kubernetes master is running at https://192.168.64.2:8443\nKubeDNS is running at https://192.168.64.2:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy\n\nTo further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.\n"))),(0,l.kt)("p",null,"You are now ready to deploy TiDB Operator."))),(0,l.kt)("h2",{id:"step-2-deploy-tidb-operator"},"Step 2. Deploy TiDB Operator"),(0,l.kt)("p",null,"You need to install TiDB Operator CRDs first, and then install TiDB Operator."),(0,l.kt)("h3",{id:"install-tidb-operator-crds"},"Install TiDB Operator CRDs"),(0,l.kt)("p",null,"TiDB Operator includes a number of Custom Resource Definitions (CRDs) that implement different components of the TiDB cluster."),(0,l.kt)("p",null,"Run the following command to install the CRDs into your cluster:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f https://raw.githubusercontent.com/pingcap/tidb-operator/v1.2.4/manifests/crd.yaml\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"customresourcedefinition.apiextensions.k8s.io/tidbclusters.pingcap.com created\ncustomresourcedefinition.apiextensions.k8s.io/backups.pingcap.com created\ncustomresourcedefinition.apiextensions.k8s.io/restores.pingcap.com created\ncustomresourcedefinition.apiextensions.k8s.io/backupschedules.pingcap.com created\ncustomresourcedefinition.apiextensions.k8s.io/tidbmonitors.pingcap.com created\ncustomresourcedefinition.apiextensions.k8s.io/tidbinitializers.pingcap.com created\ncustomresourcedefinition.apiextensions.k8s.io/tidbclusterautoscalers.pingcap.com created\n"))),(0,l.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"For Kubernetes earlier than 1.16, only v1beta1 CRD is supported. Therefore, you need to change ",(0,l.kt)("inlineCode",{parentName:"p"},"crd.yaml")," in the preceding command to ",(0,l.kt)("inlineCode",{parentName:"p"},"crd_v1beta1.yaml"),"."))),(0,l.kt)("h3",{id:"install-tidb-operator"},"Install TiDB Operator"),(0,l.kt)("p",null,"This section describes how to install TiDB Operator using ",(0,l.kt)("a",{parentName:"p",href:"https://helm.sh/docs/intro/install/"},"Helm 3"),"."),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Add the PingCAP repository:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"helm repo add pingcap https://charts.pingcap.org/\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre"},'"pingcap" has been added to your repositories\n')))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Create a namespace for TiDB Operator:"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl create namespace tidb-admin\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre"},"namespace/tidb-admin created\n")))),(0,l.kt)("li",{parentName:"ol"},(0,l.kt)("p",{parentName:"li"},"Install TiDB Operator"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"helm install --namespace tidb-admin tidb-operator pingcap/tidb-operator --version v1.2.7\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",{parentName:"li"},(0,l.kt)("code",{parentName:"pre"},"NAME: tidb-operator\nLAST DEPLOYED: Mon Jun  1 12:31:43 2020\nNAMESPACE: tidb-admin\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\nMake sure tidb-operator components are running:\n\n    kubectl get pods --namespace tidb-admin -l app.kubernetes.io/instance=tidb-operator\n"))))),(0,l.kt)("p",null,"To confirm that the TiDB Operator components are running, run the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get pods --namespace tidb-admin -l app.kubernetes.io/instance=tidb-operator\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"NAME                                       READY   STATUS    RESTARTS   AGE\ntidb-controller-manager-6d8d5c6d64-b8lv4   1/1     Running   0          2m22s\ntidb-scheduler-644d59b46f-4f6sb            2/2     Running   0          2m22s\n"))),(0,l.kt)("p",null,'As soon as all Pods are in the "Running" state, proceed to the next step.'),(0,l.kt)("h2",{id:"step-3-deploy-a-tidb-cluster-and-its-monitoring-services"},"Step 3. Deploy a TiDB cluster and its monitoring services"),(0,l.kt)("p",null,"This section describes how to deploy a TiDB cluster and its monitoring services."),(0,l.kt)("h3",{id:"deploy-a-tidb-cluster"},"Deploy a TiDB cluster"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl create namespace tidb-cluster && \\\n    kubectl -n tidb-cluster apply -f https://raw.githubusercontent.com/pingcap/tidb-operator/master/examples/basic/tidb-cluster.yaml\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"namespace/tidb-cluster created\ntidbcluster.pingcap.com/basic created\n"))),(0,l.kt)("p",null,"If you need to deploy a TiDB cluster on an ARM64 machine, refer to ",(0,l.kt)("a",{parentName:"p",href:"/deploy-cluster-on-arm64"},"Deploy a TiDB Cluster on ARM64 Machines"),"."),(0,l.kt)("h3",{id:"deploy-tidb-monitoring-services"},"Deploy TiDB monitoring services"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl -n tidb-cluster apply -f https://raw.githubusercontent.com/pingcap/tidb-operator/master/examples/basic/tidb-monitor.yaml\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"tidbmonitor.pingcap.com/basic created\n"))),(0,l.kt)("h3",{id:"view-the-pod-status"},"View the Pod status"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"watch kubectl get po -n tidb-cluster\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"NAME                              READY   STATUS    RESTARTS   AGE\nbasic-discovery-6bb656bfd-xl5pb   1/1     Running   0          9m9s\nbasic-monitor-5fc8589c89-gvgjj    3/3     Running   0          8m58s\nbasic-pd-0                        1/1     Running   0          9m8s\nbasic-tidb-0                      2/2     Running   0          7m14s\nbasic-tikv-0                      1/1     Running   0          8m13s\n"))),(0,l.kt)("p",null,"Wait until all Pods for all services are started. As soon as you see Pods of each type (",(0,l.kt)("inlineCode",{parentName:"p"},"-pd"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"-tikv"),", and ",(0,l.kt)("inlineCode",{parentName:"p"},"-tidb"),') are in the "Running" state, you can press ',(0,l.kt)("kbd",null,"Ctrl"),"+",(0,l.kt)("kbd",null,"C")," to get back to the command line and go on to connect to your TiDB cluster."),(0,l.kt)("h2",{id:"step-4-connect-to-tidb"},"Step 4. Connect to TiDB"),(0,l.kt)("p",null,"Because TiDB supports the MySQL protocol and most of its syntax, you can connect to TiDB using the MySQL client."),(0,l.kt)("h3",{id:"install-the-mysql-client"},"Install the MySQL client"),(0,l.kt)("p",null,"To connect to TiDB, you need a MySQL-compatible client installed on the host where ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl")," is installed. This can be the ",(0,l.kt)("inlineCode",{parentName:"p"},"mysql")," executable from an installation of MySQL Server, MariaDB Server, Percona Server, or a standalone client executable from the package of your operating system."),(0,l.kt)("h3",{id:"forward-port-4000"},"Forward port 4000"),(0,l.kt)("p",null,"You can connect to TiDB by first forwarding a port from the local host to the TiDB ",(0,l.kt)("strong",{parentName:"p"},"service")," in Kubernetes."),(0,l.kt)("p",null,"First, get a list of services in the ",(0,l.kt)("inlineCode",{parentName:"p"},"tidb-cluster")," namespace:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get svc -n tidb-cluster\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"NAME                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)              AGE\nbasic-discovery          ClusterIP   10.101.69.5      <none>        10261/TCP            10m\nbasic-grafana            ClusterIP   10.106.41.250    <none>        3000/TCP             10m\nbasic-monitor-reloader   ClusterIP   10.99.157.225    <none>        9089/TCP             10m\nbasic-pd                 ClusterIP   10.104.43.232    <none>        2379/TCP             10m\nbasic-pd-peer            ClusterIP   None             <none>        2380/TCP             10m\nbasic-prometheus         ClusterIP   10.106.177.227   <none>        9090/TCP             10m\nbasic-tidb               ClusterIP   10.99.24.91      <none>        4000/TCP,10080/TCP   8m40s\nbasic-tidb-peer          ClusterIP   None             <none>        10080/TCP            8m40s\nbasic-tikv-peer          ClusterIP   None             <none>        20160/TCP            9m39s\n"))),(0,l.kt)("p",null,"In this case, the TiDB ",(0,l.kt)("strong",{parentName:"p"},"service")," is called ",(0,l.kt)("strong",{parentName:"p"},"basic-tidb"),". Run the following command to forward this port from the local host to the cluster:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl port-forward -n tidb-cluster svc/basic-tidb 14000:4000 > pf14000.out &\n")),(0,l.kt)("p",null,"If the port ",(0,l.kt)("inlineCode",{parentName:"p"},"14000")," is already occupied, you can replace it with an available port. This command runs in the background and writes its output to a file named ",(0,l.kt)("inlineCode",{parentName:"p"},"pf14000.out"),". You can continue to run the command in the current shell session."),(0,l.kt)("h3",{id:"connect-to-the-tidb-service"},"Connect to the TiDB service"),(0,l.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"To connect to TiDB (< v4.0.7) using a MySQL 8.0 client, if the user account has a password, you must explicitly specify ",(0,l.kt)("inlineCode",{parentName:"p"},"--default-auth=mysql_native_password"),". This is because ",(0,l.kt)("inlineCode",{parentName:"p"},"mysql_native_password")," is ",(0,l.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password"},"no longer the default plugin"),"."))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"mysql --comments -h 127.0.0.1 -P 14000 -u root\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"Welcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 76\nServer version: 5.7.25-TiDB-v4.0.0 MySQL Community Server (Apache License 2.0)\n\nCopyright (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql>\n"))),(0,l.kt)("p",null,"After connecting to the cluster, you can run the following commands to verify that some features available in TiDB. Note that some commands require TiDB 4.0 or higher versions. If you have deployed an earlier version, you need to ",(0,l.kt)("a",{parentName:"p",href:"#step-5-upgrade-a-tidb-cluster"},"upgrade the TiDB cluster"),"."),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Create a ",(0,l.kt)("code",null,"hello_world")," table"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> use test;\nmysql> create table hello_world (id int unsigned not null auto_increment primary key, v varchar(32));\nQuery OK, 0 rows affected (0.17 sec)\n\nmysql> select * from information_schema.tikv_region_status where db_name=database() and table_name='hello_world'\\G\n*************************** 1. row ***************************\n       REGION_ID: 2\n       START_KEY: 7480000000000000FF3700000000000000F8\n         END_KEY:\n        TABLE_ID: 55\n         DB_NAME: test\n      TABLE_NAME: hello_world\n        IS_INDEX: 0\n        INDEX_ID: NULL\n      INDEX_NAME: NULL\n  EPOCH_CONF_VER: 5\n   EPOCH_VERSION: 23\n   WRITTEN_BYTES: 0\n      READ_BYTES: 0\nAPPROXIMATE_SIZE: 1\nAPPROXIMATE_KEYS: 0\n1 row in set (0.03 sec)\n"))),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Query the TiDB version"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> select tidb_version()\\G\n*************************** 1. row ***************************\n  tidb_version(): Release Version: v5.3.0\n         Edition: Community\n Git Commit Hash: 4a1b2e9fe5b5afb1068c56de47adb07098d768d6\n      Git Branch: heads/refs/tags/v5.3.0\n  UTC Build Time: 2021-11-24 13:32:39\n       GoVersion: go1.16.4\n    Race Enabled: false\nTiKV Min Version: v3.0.0-60965b006877ca7234adaced7890d7b029ed1306\nCheck Table Before Drop: false\n1 row in set (0.01 sec)\n"))),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Query the TiKV store status"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> select * from information_schema.tikv_store_status\\G\n*************************** 1. row ***************************\n            STORE_ID: 4\n             ADDRESS: basic-tikv-0.basic-tikv-peer.tidb-cluster.svc:20160\n         STORE_STATE: 0\n    STORE_STATE_NAME: Up\n               LABEL: null\n             VERSION: 5.2.1\n            CAPACITY: 58.42GiB\n           AVAILABLE: 36.18GiB\n        LEADER_COUNT: 3\n       LEADER_WEIGHT: 1\n        LEADER_SCORE: 3\n         LEADER_SIZE: 3\n        REGION_COUNT: 21\n       REGION_WEIGHT: 1\n        REGION_SCORE: 21\n         REGION_SIZE: 21\n            START_TS: 2020-05-28 22:48:21\n   LAST_HEARTBEAT_TS: 2020-05-28 22:52:01\n              UPTIME: 3m40.598302151s\n1 rows in set (0.01 sec)\n"))),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Query the TiDB cluster information"),(0,l.kt)("p",null,"This command is effective only in TiDB 4.0 or later versions. If your TiDB does not support the command, you need to ",(0,l.kt)("a",{parentName:"p",href:"#step-5-upgrade-a-tidb-cluster"},"Upgrade a TiDB cluster"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sql"},"mysql> select * from information_schema.cluster_info\\G\n*************************** 1. row ***************************\n            TYPE: tidb\n        INSTANCE: basic-tidb-0.basic-tidb-peer.tidb-cluster.svc:4000\n  STATUS_ADDRESS: basic-tidb-0.basic-tidb-peer.tidb-cluster.svc:10080\n         VERSION: 5.2.1\n        GIT_HASH: 689a6b6439ae7835947fcaccf329a3fc303986cb\n      START_TIME: 2020-05-28T22:50:11Z\n          UPTIME: 3m21.459090928s\n*************************** 2. row ***************************\n            TYPE: pd\n        INSTANCE: basic-pd:2379\n  STATUS_ADDRESS: basic-pd:2379\n         VERSION: 5.2.1\n        GIT_HASH: 56d4c3d2237f5bf6fb11a794731ed1d95c8020c2\n      START_TIME: 2020-05-28T22:45:04Z\n          UPTIME: 8m28.459091915s\n*************************** 3. row ***************************\n            TYPE: tikv\n        INSTANCE: basic-tikv-0.basic-tikv-peer.tidb-cluster.svc:20160\n  STATUS_ADDRESS: 0.0.0.0:20180\n         VERSION: 5.2.1\n        GIT_HASH: 198a2cea01734ce8f46d55a29708f123f9133944\n      START_TIME: 2020-05-28T22:48:21Z\n          UPTIME: 5m11.459102648s\n3 rows in set (0.01 sec)\n"))),(0,l.kt)("h3",{id:"access-the-grafana-dashboard"},"Access the Grafana dashboard"),(0,l.kt)("p",null,"You can forward the port for Grafana to access the Grafana dashboard locally:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl port-forward -n tidb-cluster svc/basic-grafana 3000 > pf3000.out &\n")),(0,l.kt)("p",null,"You can access the Grafana dashboard at ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:3000"},"http://localhost:3000")," on the host where you run ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl"),". The default username and password in Grafana are both ",(0,l.kt)("inlineCode",{parentName:"p"},"admin"),"."),(0,l.kt)("p",null,"Note that if you run ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl")," in a Docker container or on a remote host instead of your local host, you can not access the Grafana dashboard at ",(0,l.kt)("a",{parentName:"p",href:"http://localhost:3000"},"http://localhost:3000")," from your browser. In this case, you can run the following command to listen on all addresses."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl port-forward --address 0.0.0.0 -n tidb-cluster svc/basic-grafana 3000 > pf3000.out &\n")),(0,l.kt)("p",null,"Then access Grafana through ",(0,l.kt)("a",{parentName:"p",href:"http://$%7Bremote-server-IP%7D:3000"},"http://${remote-server-IP}:3000"),"."),(0,l.kt)("p",null,"For more information about monitoring the TiDB cluster in TiDB Operator, refer to ",(0,l.kt)("a",{parentName:"p",href:"/monitor-a-tidb-cluster"},"Deploy Monitoring and Alerts for a TiDB Cluster"),"."),(0,l.kt)("h2",{id:"step-5-upgrade-a-tidb-cluster"},"Step 5. Upgrade a TiDB cluster"),(0,l.kt)("p",null,'TiDB Operator also makes it easy to perform a rolling upgrade of the TiDB cluster. This section describes how to upgrade your TiDB cluster to the "nightly" release.'),(0,l.kt)("p",null,"Before that, you need to get familiar with a ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl")," sub-command ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl patch"),". It applies a specification change directly to the running cluster resources. There are several different patch strategies, each of which has various capabilities, limitations, and allowed formats. For details, see ",(0,l.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/manage-kubernetes-objects/update-api-object-kubectl-patch/"},"Kubernetes Patch")),(0,l.kt)("h3",{id:"modify-the-tidb-cluster-version"},"Modify the TiDB cluster version"),(0,l.kt)("p",null,'In this case, you can use a JSON merge patch to update the version of the TiDB cluster to "nightly":'),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'kubectl patch tc basic -n tidb-cluster --type merge -p \'{"spec": {"version": "nightly"} }\'\n')),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"tidbcluster.pingcap.com/basic patched\n"))),(0,l.kt)("h3",{id:"wait-for-pods-to-restart"},"Wait for Pods to restart"),(0,l.kt)("p",null,"To follow the progress of the cluster as its components are upgraded, run the following command. You should see some Pods transiting to ",(0,l.kt)("inlineCode",{parentName:"p"},"Terminating")," and then back to ",(0,l.kt)("inlineCode",{parentName:"p"},"ContainerCreating")," and then to ",(0,l.kt)("inlineCode",{parentName:"p"},"Running"),"."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"watch kubectl get po -n tidb-cluster\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"NAME                              READY   STATUS        RESTARTS   AGE\nbasic-discovery-6bb656bfd-7lbhx   1/1     Running       0          24m\nbasic-pd-0                        1/1     Terminating   0          5m31s\nbasic-tidb-0                      2/2     Running       0          2m19s\nbasic-tikv-0                      1/1     Running       0          4m13s\n"))),(0,l.kt)("h3",{id:"forward-the-tidb-service-port"},"Forward the TiDB service port"),(0,l.kt)("p",null,"After all Pods have been restarted, you can see that the version number of the cluster has changed."),(0,l.kt)("p",null,"Note that you need to reset any port forwarding you set up in a previous step, because the pods they forwarded to have been destroyed and recreated."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"kubectl port-forward -n tidb-cluster svc/basic-tidb 24000:4000 > pf24000.out &\n")),(0,l.kt)("p",null,"If the port ",(0,l.kt)("inlineCode",{parentName:"p"},"24000")," is already occupied, you can replace it with an available port."),(0,l.kt)("h3",{id:"check-the-tidb-cluster-version"},"Check the TiDB cluster version"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"mysql --comments -h 127.0.0.1 -P 24000 -u root -e 'select tidb_version()\\G'\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Expected output"),(0,l.kt)("p",null,"Note that ",(0,l.kt)("inlineCode",{parentName:"p"},"nightly")," is not a fixed version. Running the command above at a different time might return different results."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"*************************** 1. row ***************************\ntidb_version(): Release Version: v5.4.0-alpha-445-g778e188fa\nEdition: Community\nGit Commit Hash: 778e188fa7af4f48497ff9e05ca6681bf9a5fa16\nGit Branch: master\nUTC Build Time: 2021-12-17 17:02:49\nGoVersion: go1.16.4\nRace Enabled: false\nTiKV Min Version: v3.0.0-60965b006877ca7234adaced7890d7b029ed1306\nCheck Table Before Drop: false\n"))),(0,l.kt)("h2",{id:"step-6-destroy-the-tidb-cluster-and-the-kubernetes-cluster"},"Step 6. Destroy the TiDB cluster and the Kubernetes cluster"),(0,l.kt)("p",null,"After you finish testing, you can destroy the TiDB cluster and the Kubernetes cluster."),(0,l.kt)("h3",{id:"destroy-the-tidb-cluster"},"Destroy the TiDB cluster"),(0,l.kt)("p",null,"This section introduces how to destroy a TiDB cluster."),(0,l.kt)("h4",{id:"stop-kubectl-port-forwarding"},"Stop ",(0,l.kt)("inlineCode",{parentName:"h4"},"kubectl")," port forwarding"),(0,l.kt)("p",null,"If you still have running ",(0,l.kt)("inlineCode",{parentName:"p"},"kubectl")," processes that are forwarding ports, end them:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"pgrep -lfa kubectl\n")),(0,l.kt)("h4",{id:"delete-the-tidb-cluster"},"Delete the TiDB cluster"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl delete tc basic -n tidb-cluster\n")),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"tc")," in this command is a short name for tidbclusters."),(0,l.kt)("h4",{id:"delete-tidb-monitoring-services"},"Delete TiDB monitoring services"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl delete tidbmonitor basic -n tidb-cluster\n")),(0,l.kt)("h4",{id:"delete-pv-data"},"Delete PV data"),(0,l.kt)("p",null,"If your deployment has persistent data storage, deleting the TiDB cluster does not remove the data in the cluster. If you do not need the data, run the following commands to clean it:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'kubectl delete pvc -n tidb-cluster -l app.kubernetes.io/instance=basic,app.kubernetes.io/managed-by=tidb-operator && \\\nkubectl get pv -l app.kubernetes.io/namespace=tidb-cluster,app.kubernetes.io/managed-by=tidb-operator,app.kubernetes.io/instance=basic -o name | xargs -I {} kubectl patch {} -p \'{"spec":{"persistentVolumeReclaimPolicy":"Delete"}}\'\n')),(0,l.kt)("h4",{id:"delete-namespaces"},"Delete namespaces"),(0,l.kt)("p",null,"To ensure that there are no lingering resources, delete the namespace used for your TiDB cluster."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl delete namespace tidb-cluster\n")),(0,l.kt)("h3",{id:"destroy-the-kubernetes-cluster"},"Destroy the Kubernetes cluster"),(0,l.kt)("p",null,"The method of destroying a Kubernetes cluster depends on how you create it. Here are the steps for destroying a Kubernetes cluster."),(0,l.kt)(m,{mdxType:"SimpleTab"},(0,l.kt)("div",{label:"kind"},(0,l.kt)("p",null,"To destroy a Kubernetes cluster created using kind, run the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kind delete cluster\n"))),(0,l.kt)("div",{label:"minikube"},(0,l.kt)("p",null,"To destroy a Kubernetes cluster created using minikube, run the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"minikube delete\n")))),(0,l.kt)("h2",{id:"see-also"},"See also"),(0,l.kt)("p",null,"If you want to deploy a TiDB cluster in production environments, refer to the following documents:"),(0,l.kt)("p",null,"On public clouds:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"/deploy-on-aws-eks"},"Deploy TiDB on AWS EKS")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"/deploy-on-gcp-gke"},"Deploy TiDB on GCP GKE")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"/deploy-on-azure-aks"},"Deploy TiDB on Azure AKS")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"/deploy-on-alibaba-cloud"},"Deploy TiDB on Alibaba Cloud ACK"))),(0,l.kt)("p",null,"In a self-managed Kubernetes cluster:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Familiarize yourself with ",(0,l.kt)("a",{parentName:"li",href:"/prerequisites"},"Prerequisites for TiDB in Kubernetes")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"/configure-storage-class#local-pv-configuration"},"Configure the local PV")," for your Kubernetes cluster to achieve high performance for TiKV"),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"/deploy-tidb-operator"},"Deploy TiDB Operator in Kubernetes")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"/deploy-on-general-kubernetes"},"Deploy TiDB in General Kubernetes"))))}h.isMDXComponent=!0}}]);