<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.16">
<title data-rh="true">Manually Scale TiDB in Kubernetes | TiDB in Kubernetes Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ran-huang.github.io/docusaurus-operator/scale-a-tidb-cluster"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Manually Scale TiDB in Kubernetes | TiDB in Kubernetes Docs"><meta data-rh="true" name="description" content="This document introduces how to horizontally and vertically scale a TiDB cluster in Kubernetes."><meta data-rh="true" property="og:description" content="This document introduces how to horizontally and vertically scale a TiDB cluster in Kubernetes."><link data-rh="true" rel="icon" href="/docusaurus-operator/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ran-huang.github.io/docusaurus-operator/scale-a-tidb-cluster"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/docusaurus-operator/scale-a-tidb-cluster" hreflang="en"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/docusaurus-operator/scale-a-tidb-cluster" hreflang="x-default"><link rel="stylesheet" href="/docusaurus-operator/assets/css/styles.68554639.css">
<link rel="preload" href="/docusaurus-operator/assets/js/runtime~main.f81f0faa.js" as="script">
<link rel="preload" href="/docusaurus-operator/assets/js/main.5a4d47d5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docusaurus-operator/"><div class="navbar__logo"><img src="/docusaurus-operator/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/docusaurus-operator/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">TiDB in Kubernetes</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docusaurus-operator/">Docs</a><a class="navbar__item navbar__link" href="/docusaurus-operator/architecture">Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ran-huang/docusaurus-operator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docusaurus-operator/">TiDB in Kubernetes</a><button aria-label="Toggle the collapsible sidebar category &#x27;TiDB in Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/get-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docusaurus-operator/category/deploy">Deploy</a><button aria-label="Toggle the collapsible sidebar category &#x27;Deploy&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/restore-data-using-tidb-lightning">Migrate</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/docusaurus-operator/category/manage">Manage</a><button aria-label="Toggle the collapsible sidebar category &#x27;Manage&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docusaurus-operator/enable-tls-for-mysql-client">Secure</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docusaurus-operator/scale-a-tidb-cluster">Scale</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docusaurus-operator/upgrade-a-tidb-cluster">Upgrade</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docusaurus-operator/backup-restore-overview">Backup and Restore</a><button aria-label="Toggle the collapsible sidebar category &#x27;Backup and Restore&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docusaurus-operator/restart-a-tidb-cluster">Maintain</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docusaurus-operator/monitor-a-tidb-cluster">Monitor and Alert</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docusaurus-operator/recover-deleted-cluster">Disaster Recovery</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/tips">Troubleshoot</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/faq">FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docusaurus-operator/category/manage">Manage</a></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docusaurus-operator/scale-a-tidb-cluster">Scale</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Manually Scale TiDB in Kubernetes</h1><p>This document introduces how to horizontally and vertically scale a TiDB cluster in Kubernetes.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="horizontal-scaling">Horizontal scaling<a class="hash-link" href="#horizontal-scaling" title="Direct link to heading">â€‹</a></h2><p>Horizontally scaling TiDB means that you scale TiDB out or in by adding or remove Pods in your pool of resources. When you scale a TiDB cluster, PD, TiKV, and TiDB are scaled out or in sequentially according to the values of their replicas.</p><ul><li><p>To scale out a TiDB cluster, <strong>increase</strong> the value of <code>replicas</code> of a certain component. The scaling out operations add Pods based on the Pod ID in ascending order, until the number of Pods equals the value of <code>replicas</code>.</p></li><li><p>To scale in a TiDB cluster, <strong>decrease</strong> the value of <code>replicas</code> of a certain component. The scaling in operations remove Pods based on the Pod ID in descending order, until the number of Pods equals the value of <code>replicas</code>.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="horizontally-scale-pd-tikv-and-tidb">Horizontally scale PD, TiKV, and TiDB<a class="hash-link" href="#horizontally-scale-pd-tikv-and-tidb" title="Direct link to heading">â€‹</a></h3><p>To scale PD, TiKV, or TiDB horizontally, use kubectl to modify <code>spec.pd.replicas</code>, <code>spec.tikv.replicas</code>, and <code>spec.tidb.replicas</code> in the <code>TidbCluster</code> object of the cluster to a desired value.</p><ol><li><p>Modify the <code>replicas</code> value of a component as needed. For example, configure the <code>replicas</code> value of PD to 3:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl patch -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> tc </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain"> --type merge --patch </span><span class="token string" style="color:#e3116c">&#x27;{&quot;spec&quot;:{&quot;pd&quot;:{&quot;replicas&quot;:3}}}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Check whether your configuration has been updated in the corresponding TiDB cluster in Kubernetes.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get tidbcluster </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain"> -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> -oyaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If your configuration is successfully updated, in the <code>TidbCluster</code> CR output by the command above, the values of <code>spec.pd.replicas</code>, <code>spec.tidb.replicas</code>, and <code>spec.tikv.replicas</code> are consistent with the values you have configured.</p></li><li><p>Check whether the number of <code>TidbCluster</code> Pods has increased or decreased.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">watch</span><span class="token plain"> kubectl -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> get pod -o wide</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For the PD and TiDB components, it might take 10-30 seconds to scale in or out.</p><p>For the TiKV component, it might take 3-5 minutes to scale in or out because the process involves data migration.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="horizontally-scale-tiflash">Horizontally scale TiFlash<a class="hash-link" href="#horizontally-scale-tiflash" title="Direct link to heading">â€‹</a></h3><p>This section describes how to horizontally scale out or scale in TiFlash if you have deployed TiFlash in the cluster.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="horizontally-scale-out-tiflash">Horizontally scale out TiFlash<a class="hash-link" href="#horizontally-scale-out-tiflash" title="Direct link to heading">â€‹</a></h4><p>To scale out TiFlash horizontally, you can modify <code>spec.tiflash.replicas</code>.</p><p>For example, configure the <code>replicas</code> value of TiFlash to 3:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl patch -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> tc </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain"> --type merge --patch </span><span class="token string" style="color:#e3116c">&#x27;{&quot;spec&quot;:{&quot;tiflash&quot;:{&quot;replicas&quot;:3}}}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="horizontally-scale-in-tiflash">Horizontally scale in TiFlash<a class="hash-link" href="#horizontally-scale-in-tiflash" title="Direct link to heading">â€‹</a></h4><p>To scale in TiFlash horizontally, perform the following steps:</p><ol><li><p>Expose the PD service by using <code>port-forward</code>:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> svc/</span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain">-pd </span><span class="token number" style="color:#36acaa">2379</span><span class="token plain">:2379</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Open a <strong>new</strong> terminal tab or window. Check the maximum number (<code>N</code>) of replicas of all data tables with which TiFlash is enabled by running the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:2379/pd/api/v1/config/rules/group/tiflash </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> count</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the printed result, the largest value of <code>count</code> is the maximum number (<code>N</code>) of replicas of all data tables.</p></li><li><p>Go back to the terminal window in Step 1, where <code>port-forward</code> is running. Press <kbd>Ctrl</kbd>+<kbd>C</kbd> to stop <code>port-forward</code>.</p></li><li><p>After the scale-in operation, if the number of remaining Pods in TiFlash &gt;= <code>N</code>, skip to Step 6. Otherwise, take the following steps:</p><ol><li><p>Refer to <a href="/docusaurus-operator/access-tidb">Access TiDB</a> and connect to the TiDB service.</p></li><li><p>For all the tables that have more replicas than the remaining Pods in TiFlash, run the following command:</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx sql"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">db_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">table_name</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> tiflash replica ${pod_number}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>${pod_number}</code> indicates the number of remaining Pods in the TiFlash cluster after scaling in.</p></li></ol></li><li><p>Wait for the number of TiFlash replicas in the related tables to be updated.</p><p>Connect to the TiDB service, and run the following command to check the number:</p><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx sql"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tiflash_replica </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> TABLE_SCHEMA </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;db_name&gt;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">and</span><span class="token plain"> TABLE_NAME </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&lt;table_name&gt;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If you cannot view the replication information of related tables, the TiFlash replicas are successfully deleted.</p></li><li><p>Modify <code>spec.tiflash.replicas</code> to scale in TiFlash.</p><p>Check whether TiFlash in the TiDB cluster in Kubernetes has updated to your desired definition. Run the following command and see whether the value of <code>spec.tiflash.replicas</code> returned is expected:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get tidbcluster </span><span class="token variable" style="color:#36acaa">${cluster-name}</span><span class="token plain"> -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> -oyaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="horizontally-scale-ticdc">Horizontally scale TiCDC<a class="hash-link" href="#horizontally-scale-ticdc" title="Direct link to heading">â€‹</a></h4><p>If TiCDC is deployed in the cluster, you can horizontally scale out or scale in TiCDC by modifying the value of <code>spec.ticdc.replicas</code>.</p><p>For example, configure the <code>replicas</code> value of TiCDC to 3:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl patch -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> tc </span><span class="token variable" style="color:#36acaa">${cluster_name}</span><span class="token plain"> --type merge --patch </span><span class="token string" style="color:#e3116c">&#x27;{&quot;spec&quot;:{&quot;ticdc&quot;:{&quot;replicas&quot;:3}}}&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="view-the-horizontal-scaling-status">View the horizontal scaling status<a class="hash-link" href="#view-the-horizontal-scaling-status" title="Direct link to heading">â€‹</a></h3><p>To view the scaling status of the cluster, run the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">watch</span><span class="token plain"> kubectl -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> get pod -o wide</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When the number of Pods for all components reaches the preset value and all components go to the <code>Running</code> state, the horizontal scaling is completed.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>The PD, TiKV and TiFlash components do not trigger the rolling update operations during scaling in and out.</li><li>When the TiKV component scales in, TiDB Operator calls the PD interface to mark the corresponding TiKV instance as offline, and then migrates the data on it to other TiKV nodes. During the data migration, the TiKV Pod is still in the <code>Running</code> state, and the corresponding Pod is deleted only after the data migration is completed. The time consumed by scaling in depends on the amount of data on the TiKV instance to be scaled in. You can check whether TiKV is in the <code>Offline</code> state by running <code>kubectl get -n ${namespace} tidbcluster ${cluster_name} -o json | jq &#x27;.status.tikv.stores&#x27;</code>.</li><li>When the number of <code>UP</code> stores is equal to or less than the parameter value of <code>MaxReplicas</code> in the PD configuration, the TiKV components can not be scaled in.</li><li>The TiKV component does not support scale out while a scale-in operation is in progress. Forcing a scale-out operation might cause anomalies in the cluster. If an anomaly already happens, refer to <a href="/docusaurus-operator/exceptions#tikv-store-is-in-tombstone-status-abnormally">TiKV Store is in Tombstone status abnormally</a> to fix it.</li><li>The TiFlash component has the same scale-in logic as TiKV.</li><li>When the PD, TiKV, and TiFlash components scale in, the PVC of the deleted node is retained during the scaling in process. Because the PV&#x27;s reclaim policy is changed to <code>Retain</code>, the data can still be retrieved even if the PVC is deleted.</li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="vertical-scaling">Vertical scaling<a class="hash-link" href="#vertical-scaling" title="Direct link to heading">â€‹</a></h2><p>Vertically scaling TiDB means that you scale TiDB up or down by increasing or decreasing the limit of resources on the Pod. Vertically scaling is essentially the rolling update of the Pods.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="vertically-scale-components">Vertically scale components<a class="hash-link" href="#vertically-scale-components" title="Direct link to heading">â€‹</a></h3><p>This section describes how to vertically scale up or scale down components including PD, TiKV, TiDB, TiFlash, and TiCDC.</p><ul><li><p>To scale up or scale down PD, TiKV, TiDB, use kubectl to modify <code>spec.pd.resources</code>, <code>spec.tikv.resources</code>, and <code>spec.tidb.resources</code> in the <code>TidbCluster</code> object that corresponds to the cluster to a desired value.</p></li><li><p>To scale up or scale down TiFlash, modify the value of <code>spec.tiflash.resources</code>.</p></li><li><p>To scale up or scale down TiCDC, modify the value of <code>spec.ticdc.resources</code>.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="view-the-vertical-scaling-progress">View the vertical scaling progress<a class="hash-link" href="#view-the-vertical-scaling-progress" title="Direct link to heading">â€‹</a></h3><p>To view the upgrade progress of the cluster, run the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">watch</span><span class="token plain"> kubectl -n </span><span class="token variable" style="color:#36acaa">${namespace}</span><span class="token plain"> get pod -o wide</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When all Pods are rebuilt and in the <code>Running</code> state, the vertical scaling is completed.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>If the resource&#x27;s <code>requests</code> field is modified during the vertical scaling process, and if PD, TiKV, and TiFlash use <code>Local PV</code>, they will be scheduled back to the original node after the upgrade. At this time, if the original node does not have enough resources, the Pod ends up staying in the <code>Pending</code> status and thus impacts the service.</li><li>TiDB is a horizontally scalable database, so it is recommended to take advantage of it simply by adding more nodes rather than upgrading hardware resources like you do with a traditional database.</li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="scaling-troubleshooting">Scaling troubleshooting<a class="hash-link" href="#scaling-troubleshooting" title="Direct link to heading">â€‹</a></h2><p>During the horizontal or vertical scaling operation, Pods might go to the Pending state because of insufficient resources. See <a href="/docusaurus-operator/deploy-failures#the-pod-is-in-the-pending-state">Troubleshoot the Pod in Pending state</a> to resolve it.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/scale-a-tidb-cluster.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docusaurus-operator/containers-run-as-non-root-user"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Run Containers as a Non-root User</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docusaurus-operator/upgrade-a-tidb-cluster"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Upgrade a TiDB Cluster in Kubernetes</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#horizontal-scaling" class="table-of-contents__link toc-highlight">Horizontal scaling</a><ul><li><a href="#horizontally-scale-pd-tikv-and-tidb" class="table-of-contents__link toc-highlight">Horizontally scale PD, TiKV, and TiDB</a></li><li><a href="#horizontally-scale-tiflash" class="table-of-contents__link toc-highlight">Horizontally scale TiFlash</a></li><li><a href="#view-the-horizontal-scaling-status" class="table-of-contents__link toc-highlight">View the horizontal scaling status</a></li></ul></li><li><a href="#vertical-scaling" class="table-of-contents__link toc-highlight">Vertical scaling</a><ul><li><a href="#vertically-scale-components" class="table-of-contents__link toc-highlight">Vertically scale components</a></li><li><a href="#view-the-vertical-scaling-progress" class="table-of-contents__link toc-highlight">View the vertical scaling progress</a></li></ul></li><li><a href="#scaling-troubleshooting" class="table-of-contents__link toc-highlight">Scaling troubleshooting</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docusaurus-operator/">User Manual</a></li><li class="footer__item"><a class="footer__link-item" href="/docusaurus-operator/architecture">Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/tidb" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://tidb.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>tidb.io<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/pingcap" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/pingcap/tidb-operator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Source Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 TiDB in Kubernetes Docs, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docusaurus-operator/assets/js/runtime~main.f81f0faa.js"></script>
<script src="/docusaurus-operator/assets/js/main.5a4d47d5.js"></script>
</body>
</html>