<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.16">
<title data-rh="true">Deploy TiDB Operator in Kubernetes | TiDB in Kubernetes Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ran-huang.github.io/docusaurus-operator/deploy-tidb-operator"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deploy TiDB Operator in Kubernetes | TiDB in Kubernetes Docs"><meta data-rh="true" name="description" content="This document describes how to deploy TiDB Operator in Kubernetes."><meta data-rh="true" property="og:description" content="This document describes how to deploy TiDB Operator in Kubernetes."><link data-rh="true" rel="icon" href="/docusaurus-operator/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ran-huang.github.io/docusaurus-operator/deploy-tidb-operator"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/docusaurus-operator/deploy-tidb-operator" hreflang="en"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/docusaurus-operator/deploy-tidb-operator" hreflang="x-default"><link rel="stylesheet" href="/docusaurus-operator/assets/css/styles.68554639.css">
<link rel="preload" href="/docusaurus-operator/assets/js/runtime~main.f81f0faa.js" as="script">
<link rel="preload" href="/docusaurus-operator/assets/js/main.5a4d47d5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docusaurus-operator/"><div class="navbar__logo"><img src="/docusaurus-operator/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/docusaurus-operator/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">TiDB in Kubernetes</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docusaurus-operator/">Docs</a><a class="navbar__item navbar__link" href="/docusaurus-operator/architecture">Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ran-huang/docusaurus-operator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docusaurus-operator/">TiDB in Kubernetes</a><button aria-label="Toggle the collapsible sidebar category &#x27;TiDB in Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/get-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/docusaurus-operator/category/deploy">Deploy</a><button aria-label="Toggle the collapsible sidebar category &#x27;Deploy&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docusaurus-operator/prerequisites">In Self-Managed Kubernetes</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/prerequisites">Prerequisites for TiDB in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/configure-storage-class">Persistent Storage Class Configuration in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docusaurus-operator/deploy-tidb-operator">Deploy TiDB Operator in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/configure-a-tidb-cluster">Configure a TiDB Cluster in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-on-general-kubernetes">Deploy TiDB in General Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/initialize-a-cluster">Initialize a TiDB Cluster in Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/access-tidb">Access the TiDB Cluster in Kubernetes</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docusaurus-operator/deploy-on-aws-eks">In Public Cloud Kubernetes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-cluster-on-arm64">On ARM64</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-tiflash">HTAP</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docusaurus-operator/build-multi-aws-eks">Across Multiple Kubernetes Clusters</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-heterogeneous-tidb-cluster">Heterogeneous Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-tidb-enterprise-edition">Enterprise Edition</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-ticdc">TiCDC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-tidb-binlog">TiDB Binlog</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/restore-data-using-tidb-lightning">Migrate</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docusaurus-operator/category/manage">Manage</a><button aria-label="Toggle the collapsible sidebar category &#x27;Manage&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/tips">Troubleshoot</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/faq">FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docusaurus-operator/category/deploy">Deploy</a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">In Self-Managed Kubernetes</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docusaurus-operator/deploy-tidb-operator">Deploy TiDB Operator in Kubernetes</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Deploy TiDB Operator in Kubernetes</h1><p>This document describes how to deploy TiDB Operator in Kubernetes.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">â€‹</a></h2><p>Before deploying TiDB Operator, make sure the following items are installed on your machine:</p><ul><li>Kubernetes &gt;= v1.12</li><li><a href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-dns-cluster/" target="_blank" rel="noopener noreferrer">DNS addons</a></li><li><a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/" target="_blank" rel="noopener noreferrer">PersistentVolume</a></li><li><a href="https://kubernetes.io/docs/admin/authorization/rbac" target="_blank" rel="noopener noreferrer">RBAC</a> enabled (optional)</li><li><a href="https://helm.sh" target="_blank" rel="noopener noreferrer">Helm 3</a></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="deploy-the-kubernetes-cluster">Deploy the Kubernetes cluster<a class="hash-link" href="#deploy-the-kubernetes-cluster" title="Direct link to heading">â€‹</a></h3><p>TiDB Operator runs in the Kubernetes cluster. You can refer to <a href="https://kubernetes.io/docs/setup/" target="_blank" rel="noopener noreferrer">the document of how to set up Kubernetes</a> to set up a Kubernetes cluster. Make sure that the Kubernetes version is v1.12 or higher. If you want to deploy a very simple Kubernetes cluster for testing purposes, consult the <a href="/docusaurus-operator/get-started">Get Started</a> document.</p><p>For some public cloud environments, refer to the following documents:</p><ul><li><a href="/docusaurus-operator/deploy-on-aws-eks">Deploy on AWS EKS</a></li><li><a href="/docusaurus-operator/deploy-on-gcp-gke">Deploy on GCP GKE</a></li><li><a href="/docusaurus-operator/deploy-on-alibaba-cloud">Deploy on Alibaba Cloud ACK</a></li></ul><p>TiDB Operator uses <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/" target="_blank" rel="noopener noreferrer">Persistent Volumes</a> to persist the data of TiDB cluster (including the database, monitoring data, and backup data), so the Kubernetes cluster must provide at least one kind of persistent volumes.</p><p>It is recommended to enable <a href="https://kubernetes.io/docs/admin/authorization/rbac" target="_blank" rel="noopener noreferrer">RBAC</a> in the Kubernetes cluster.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="install-helm">Install Helm<a class="hash-link" href="#install-helm" title="Direct link to heading">â€‹</a></h3><p>Refer to <a href="/docusaurus-operator/tidb-toolkit#use-helm">Use Helm</a> to install Helm and configure it with the official PingCAP chart repository.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="deploy-tidb-operator">Deploy TiDB Operator<a class="hash-link" href="#deploy-tidb-operator" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="create-crd">Create CRD<a class="hash-link" href="#create-crd" title="Direct link to heading">â€‹</a></h3><p>TiDB Operator uses <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#customresourcedefinitions" target="_blank" rel="noopener noreferrer">Custom Resource Definition (CRD)</a> to extend Kubernetes. Therefore, to use TiDB Operator, you must first create the <code>TidbCluster</code> CRD, which is a one-time job in your Kubernetes cluster.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://raw.githubusercontent.com/pingcap/tidb-operator/v1.2.4/manifests/crd.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If the server cannot access the Internet, you need to download the <code>crd.yaml</code> file on a machine with Internet access before installing:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> https://raw.githubusercontent.com/pingcap/tidb-operator/v1.2.4/manifests/crd.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f ./crd.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If the following message is displayed, the CRD installation is successful:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get crd</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                 CREATED AT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backups.pingcap.com                  </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain">-06-11T07:59:40Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backupschedules.pingcap.com          </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain">-06-11T07:59:41Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">restores.pingcap.com                 </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain">-06-11T07:59:40Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidbclusterautoscalers.pingcap.com   </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain">-06-11T07:59:42Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidbclusters.pingcap.com             </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain">-06-11T07:59:38Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidbinitializers.pingcap.com         </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain">-06-11T07:59:42Z</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidbmonitors.pingcap.com             </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain">-06-11T07:59:41Z</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="customize-tidb-operator-deployment">Customize TiDB Operator deployment<a class="hash-link" href="#customize-tidb-operator-deployment" title="Direct link to heading">â€‹</a></h3><p>To deploy TiDB Operator quickly, you can refer to <a href="/docusaurus-operator/get-started#step-2-deploy-tidb-operator">Deploy TiDB Operator</a>. This section describes how to customize the deployment of TiDB Operator.</p><p>After creating CRDs in the step above, there are two methods to deploy TiDB Operator on your Kubernetes cluster: online and offline.</p><p>When you use TiDB Operator, <code>tidb-scheduler</code> is not mandatory. Refer to <a href="/docusaurus-operator/tidb-scheduler#tidb-scheduler-and-default-scheduler">tidb-scheduler and default-scheduler</a> to confirm whether you need to deploy <code>tidb-scheduler</code>. If you do not need <code>tidb-scheduler</code>, you can configure <code>scheduler.create: false</code> in the <code>values.yaml</code> file, so <code>tidb-scheduler</code> is not deployed.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="online-deployment">Online deployment<a class="hash-link" href="#online-deployment" title="Direct link to heading">â€‹</a></h4><ol><li><p>Get the <code>values.yaml</code> file of the <code>tidb-operator</code> chart you want to deploy:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p </span><span class="token variable" style="color:#36acaa">${</span><span class="token variable environment constant" style="color:#36acaa">HOME</span><span class="token variable" style="color:#36acaa">}</span><span class="token plain">/tidb-operator </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm inspect values pingcap/tidb-operator --version</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${chart_version}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${</span><span class="token variable environment constant" style="color:#36acaa">HOME</span><span class="token variable" style="color:#36acaa">}</span><span class="token plain">/tidb-operator/values-tidb-operator.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p><strong>Note:</strong></p><p><code>${chart_version}</code> represents the chart version of TiDB Operator. For example, <code>v1.2.7</code>. You can view the currently supported versions by running the <code>helm search repo -l tidb-operator</code> command.</p></blockquote></li><li><p>Configure TiDB Operator</p><p>TiDB Operator manages all TiDB clusters in the Kubernetes cluster by default. If you only need it to manage clusters in a specific namespace, you can set <code>clusterScoped: false</code> in <code>values.yaml</code>.</p><blockquote><p><strong>Note:</strong></p><p>After setting <code>clusterScoped: false</code>, TiDB Operator will still operate Nodes, Persistent Volumes, and Storage Classes in the Kubernetes cluster by default. If the role that deploys TiDB Operator does not have the permissions to operate these resources, you can set the corresponding permission request under <code>controllerManager.clusterPermissions</code> to <code>false</code> to disable TiDB Operator&#x27;s operations on these resources.</p></blockquote><p>You can modify other items such as <code>limits</code>, <code>requests</code>, and <code>replicas</code> as needed.</p></li><li><p>Deploy TiDB Operator</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> tidb-operator pingcap/tidb-operator --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb-admin --version</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${chart_version}</span><span class="token plain"> -f </span><span class="token variable" style="color:#36acaa">${</span><span class="token variable environment constant" style="color:#36acaa">HOME</span><span class="token variable" style="color:#36acaa">}</span><span class="token plain">/tidb-operator/values-tidb-operator.yaml </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get po -n tidb-admin -l app.kubernetes.io/name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb-operator</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p><strong>Note:</strong></p><p>If the corresponding <code>tidb-admin</code> namespace does not exist, you can create the namespace first by running the <code>kubectl create namespace tidb-admin</code> command.</p></blockquote></li><li><p>Upgrade TiDB Operator</p><p>If you need to upgrade the TiDB Operator, modify the <code>${HOME}/tidb-operator/values-tidb-operator.yaml</code> file, and then execute the following command to upgrade:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade tidb-operator pingcap/tidb-operator --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb-admin -f </span><span class="token variable" style="color:#36acaa">${</span><span class="token variable environment constant" style="color:#36acaa">HOME</span><span class="token variable" style="color:#36acaa">}</span><span class="token plain">/tidb-operator/values-tidb-operator.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="offline-installation">Offline installation<a class="hash-link" href="#offline-installation" title="Direct link to heading">â€‹</a></h4><p>If your server cannot access the Internet, install TiDB Operator offline by the following steps:</p><ol><li><p>Download the <code>tidb-operator</code> chart</p><p>If the server has no access to the Internet, you cannot configure the Helm repository to install the TiDB Operator component and other applications. At this time, you need to download the chart file needed for cluster installation on a machine with Internet access, and then copy it to the server.</p><p>Use the following command to download the <code>tidb-operator</code> chart file:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">wget</span><span class="token plain"> http://charts.pingcap.org/tidb-operator-v1.2.7.tgz</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Copy the <code>tidb-operator-v1.2.7.tgz</code> file to the target server and extract it to the current directory:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> zxvf tidb-operator.v1.2.7.tgz</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Download the Docker images used by TiDB Operator</p><p>If the server has no access to the Internet, you need to download all Docker images used by TiDB Operator on a machine with Internet access and upload them to the server, and then use <code>docker load</code> to install the Docker image on the server.</p><p>The Docker images used by TiDB Operator are:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">pingcap/tidb-operator:v1.2.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pingcap/tidb-backup-manager:v1.2.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bitnami/kubectl:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pingcap/advanced-statefulset:v0.3.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s.gcr.io/kube-scheduler:v1.16.9</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Among them, <code>k8s.gcr.io/kube-scheduler:v1.16.9</code> should be consistent with the version of your Kubernetes cluster. You do not need to download it separately.</p><p>Next, download all these images using the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull pingcap/tidb-operator:v1.2.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull pingcap/tidb-backup-manager:v1.2.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull bitnami/kubectl:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> pull pingcap/advanced-statefulset:v0.3.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> save -o tidb-operator-v1.2.7.tar pingcap/tidb-operator:v1.2.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> save -o tidb-backup-manager-v1.2.7.tar pingcap/tidb-backup-manager:v1.2.7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> save -o bitnami-kubectl.tar bitnami/kubectl:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> save -o advanced-statefulset-v0.3.3.tar pingcap/advanced-statefulset:v0.3.3</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Next, upload these Docker images to the server, and execute <code>docker load</code> to install these Docker images on the server:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> load -i tidb-operator-v1.2.7.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> load -i tidb-backup-manager-v1.2.7.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> load -i bitnami-kubectl.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> load -i advanced-statefulset-v0.3.3.tar</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Configure TiDB Operator</p><p>TiDB Operator embeds a <code>kube-scheduler</code> to implement a custom scheduler. If you need to deploy <code>tidb-scheduler</code>, modify the <code>./tidb-operator/values.yaml</code> file to configure the Docker image&#x27;s name and version of this built-in <code>kube-scheduler</code> component. For example, if <code>kube-scheduler</code> in your Kubernetes cluster uses the image <code>k8s.gcr.io/kube-scheduler:v1.16.9</code>, set <code>./tidb-operator/values.yaml</code> as follows:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scheduler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  serviceAccount: tidb-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  logLevel: </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  schedulerName: tidb-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    limits:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cpu: 250m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      memory: 150Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      cpu: 80m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      memory: 50Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kubeSchedulerImageName: k8s.gcr.io/kube-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kubeSchedulerImageTag: v1.16.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can modify other items such as <code>limits</code>, <code>requests</code>, and <code>replicas</code> as needed.</p></li><li><p>Install TiDB Operator</p><p>Install TiDB Operator using the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> tidb-operator ./tidb-operator --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb-admin</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><blockquote><p><strong>Note:</strong></p><p>If the corresponding <code>tidb-admin</code> namespace does not exist, you can create the namespace first by running the <code>kubectl create namespace tidb-admin</code> command.</p></blockquote></li><li><p>Upgrade TiDB Operator</p><p>If you need to upgrade TiDB Operator, modify the <code>./tidb-operator/values.yaml</code> file, and then execute the following command to upgrade:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade tidb-operator ./tidb-operator --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb-admin</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="customize-tidb-operator">Customize TiDB Operator<a class="hash-link" href="#customize-tidb-operator" title="Direct link to heading">â€‹</a></h2><p>To customize TiDB Operator, modify <code>${HOME}/tidb-operator/values-tidb-operator.yaml</code>. The rest sections of the document use <code>values.yaml</code> to refer to <code>${HOME}/tidb-operator/values-tidb-operator.yaml</code></p><p>TiDB Operator contains two components:</p><ul><li>tidb-controller-manager</li><li>tidb-scheduler</li></ul><p>These two components are stateless and deployed via <code>Deployment</code>. You can customize resource <code>limit</code>, <code>request</code>, and <code>replicas</code> in the <code>values.yaml</code> file.</p><p>After modifying <code>values.yaml</code>, run the following command to apply this modification:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade tidb-operator pingcap/tidb-operator --version</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${chart_version}</span><span class="token plain"> --namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb-admin -f </span><span class="token variable" style="color:#36acaa">${</span><span class="token variable environment constant" style="color:#36acaa">HOME</span><span class="token variable" style="color:#36acaa">}</span><span class="token plain">/tidb-operator/values-tidb-operator.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/deploy-tidb-operator.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docusaurus-operator/configure-storage-class"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Persistent Storage Class Configuration in Kubernetes</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docusaurus-operator/configure-a-tidb-cluster"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configure a TiDB Cluster in Kubernetes</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a><ul><li><a href="#deploy-the-kubernetes-cluster" class="table-of-contents__link toc-highlight">Deploy the Kubernetes cluster</a></li><li><a href="#install-helm" class="table-of-contents__link toc-highlight">Install Helm</a></li></ul></li><li><a href="#deploy-tidb-operator" class="table-of-contents__link toc-highlight">Deploy TiDB Operator</a><ul><li><a href="#create-crd" class="table-of-contents__link toc-highlight">Create CRD</a></li><li><a href="#customize-tidb-operator-deployment" class="table-of-contents__link toc-highlight">Customize TiDB Operator deployment</a></li></ul></li><li><a href="#customize-tidb-operator" class="table-of-contents__link toc-highlight">Customize TiDB Operator</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docusaurus-operator/">User Manual</a></li><li class="footer__item"><a class="footer__link-item" href="/docusaurus-operator/architecture">Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/tidb" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://tidb.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>tidb.io<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/pingcap" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/pingcap/tidb-operator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Source Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 TiDB in Kubernetes Docs, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docusaurus-operator/assets/js/runtime~main.f81f0faa.js"></script>
<script src="/docusaurus-operator/assets/js/main.5a4d47d5.js"></script>
</body>
</html>