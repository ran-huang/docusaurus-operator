<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.16">
<title data-rh="true">Deploy TiDB on GCP GKE | TiDB in Kubernetes Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://ran-huang.github.io/docusaurus-operator/deploy-on-gcp-gke"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deploy TiDB on GCP GKE | TiDB in Kubernetes Docs"><meta data-rh="true" name="description" content="This document describes how to deploy a GCP Google Kubernetes Engine (GKE) cluster and deploy a TiDB cluster on GCP GKE."><meta data-rh="true" property="og:description" content="This document describes how to deploy a GCP Google Kubernetes Engine (GKE) cluster and deploy a TiDB cluster on GCP GKE."><link data-rh="true" rel="icon" href="/docusaurus-operator/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ran-huang.github.io/docusaurus-operator/deploy-on-gcp-gke"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/docusaurus-operator/deploy-on-gcp-gke" hreflang="en"><link data-rh="true" rel="alternate" href="https://ran-huang.github.io/docusaurus-operator/deploy-on-gcp-gke" hreflang="x-default"><link rel="stylesheet" href="/docusaurus-operator/assets/css/styles.824ca44c.css">
<link rel="preload" href="/docusaurus-operator/assets/js/runtime~main.7b6c7d1a.js" as="script">
<link rel="preload" href="/docusaurus-operator/assets/js/main.81ad91ac.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docusaurus-operator/"><div class="navbar__logo"><img src="/docusaurus-operator/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/docusaurus-operator/img/tidb-logo.svg" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">TiDB in Kubernetes</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docusaurus-operator/">Docs</a><a class="navbar__item navbar__link" href="/docusaurus-operator/architecture">Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ran-huang/docusaurus-operator" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docusaurus-operator/">TiDB in Kubernetes</a><button aria-label="Toggle the collapsible sidebar category &#x27;TiDB in Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/get-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docusaurus-operator/prerequisites">Deploy</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docusaurus-operator/prerequisites">In Self-Managed Kubernetes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docusaurus-operator/deploy-on-aws-eks">In Public Cloud Kubernetes</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-on-aws-eks">Deploy TiDB on AWS EKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docusaurus-operator/deploy-on-gcp-gke">Deploy TiDB on GCP GKE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-on-azure-aks">Deploy TiDB on Azure AKS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-on-alibaba-cloud">Deploy TiDB on Alibaba Cloud Kubernetes</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-cluster-on-arm64">On ARM64</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-tiflash">HTAP</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docusaurus-operator/build-multi-aws-eks">Across Multiple Kubernetes Clusters</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-heterogeneous-tidb-cluster">Heterogeneous Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-tidb-enterprise-edition">Enterprise Edition</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-ticdc">TiCDC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docusaurus-operator/deploy-tidb-binlog">TiDB Binlog</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/restore-data-using-tidb-lightning">Migrate</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/enable-tls-for-mysql-client">Manage</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docusaurus-operator/tips">Troubleshoot</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docusaurus-operator/faq">TiDB FAQs in Kubernetes</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Deploy</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">In Public Cloud Kubernetes</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/docusaurus-operator/deploy-on-gcp-gke">Deploy TiDB on GCP GKE</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Deploy TiDB on GCP GKE</h1><p>This document describes how to deploy a GCP Google Kubernetes Engine (GKE) cluster and deploy a TiDB cluster on GCP GKE.</p><p>To deploy TiDB Operator and the TiDB cluster in a self-managed Kubernetes environment, refer to <a href="/docusaurus-operator/deploy-tidb-operator">Deploy TiDB Operator</a> and <a href="/docusaurus-operator/deploy-on-general-kubernetes">Deploy TiDB in General Kubernetes</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">â€‹</a></h2><p>Before deploying a TiDB cluster on GCP GKE, make sure the following requirements are satisfied:</p><ul><li><p>Install <a href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener noreferrer">Helm 3</a>: used for deploying TiDB Operator.</p></li><li><p>Install <a href="https://cloud.google.com/sdk/gcloud" target="_blank" rel="noopener noreferrer">gcloud</a>: a command-line tool used for creating and managing GCP services.</p></li><li><p>Complete the operations in the <strong>Before you begin</strong> section of <a href="https://cloud.google.com/kubernetes-engine/docs/quickstart#before-you-begin" target="_blank" rel="noopener noreferrer">GKE Quickstart</a>.</p><p>  This guide includes the following contents:</p><ul><li>Enable Kubernetes APIs</li><li>Configure enough quota</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="configure-the-gcp-service">Configure the GCP service<a class="hash-link" href="#configure-the-gcp-service" title="Direct link to heading">â€‹</a></h2><p>Configure your GCP project and default region:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config </span><span class="token builtin class-name">set</span><span class="token plain"> core/project </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">gcp-project</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud config </span><span class="token builtin class-name">set</span><span class="token plain"> compute/region </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">gcp-region</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="create-a-gke-cluster-and-node-pool">Create a GKE cluster and node pool<a class="hash-link" href="#create-a-gke-cluster-and-node-pool" title="Direct link to heading">â€‹</a></h2><ol><li><p>Create a GKE cluster and a default node pool:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters create tidb --region us-east1 --machine-type n1-standard-4 --num-nodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>The command above creates a regional cluster.</li><li>The <code>--num-nodes=1</code> option indicates that one node is created in each zone. So if there are three zones in the region, there are three nodes in total, which ensures high availability.</li><li>It is recommended to use regional clusters in production environments. For other types of clusters, refer to <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/types-of-clusters" target="_blank" rel="noopener noreferrer">Types of GKE clusters</a>.</li><li>The command above creates a cluster in the default network. If you want to specify a network, use the <code>--network/subnet</code> option. For more information, refer to <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/creating-a-regional-cluster" target="_blank" rel="noopener noreferrer">Creating a regional cluster</a>.</li></ul></li><li><p>Create separate node pools for PD, TiKV, and TiDB:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools create pd --cluster tidb --machine-type n1-standard-4 --num-nodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-labels</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dedicated</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pd --node-taints</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dedicated</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">pd:NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools create tikv --cluster tidb --machine-type n1-highmem-8 --num-nodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-labels</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dedicated</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tikv --node-taints</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dedicated</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tikv:NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools create tidb --cluster tidb --machine-type n1-standard-8 --num-nodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-labels</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dedicated</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb --node-taints</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">dedicated</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tidb:NoSchedule</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The process might take a few minutes.</p></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="deploy-tidb-operator">Deploy TiDB Operator<a class="hash-link" href="#deploy-tidb-operator" title="Direct link to heading">â€‹</a></h2><p>To deploy TiDB Operator on GKE, refer to <a href="/docusaurus-operator/get-started#step-2-deploy-tidb-operator">deploy TiDB Operator</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="deploy-a-tidb-cluster-and-the-monitoring-component">Deploy a TiDB cluster and the monitoring component<a class="hash-link" href="#deploy-a-tidb-cluster-and-the-monitoring-component" title="Direct link to heading">â€‹</a></h2><p>This section describes how to deploy a TiDB cluster and its monitoring component on GCP GKE.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="create-namespace">Create namespace<a class="hash-link" href="#create-namespace" title="Direct link to heading">â€‹</a></h3><p>To create a namespace to deploy the TiDB cluster, run the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create namespace tidb-cluster</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>A <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/" target="_blank" rel="noopener noreferrer"><code>namespace</code></a> is a virtual cluster backed by the same physical cluster. This document takes <code>tidb-cluster</code> as an example. If you want to use other namespace, modify the corresponding arguments of <code>-n</code> or <code>--namespace</code>.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="deploy">Deploy<a class="hash-link" href="#deploy" title="Direct link to heading">â€‹</a></h3><p>First, download the sample <code>TidbCluster</code> and <code>TidbMonitor</code> configuration files:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -O https://raw.githubusercontent.com/pingcap/tidb-operator/master/examples/gcp/tidb-cluster.yaml </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -O https://raw.githubusercontent.com/pingcap/tidb-operator/master/examples/gcp/tidb-monitor.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Refer to <a href="/docusaurus-operator/configure-a-tidb-cluster">configure the TiDB cluster</a> to further customize and configure the CR before applying.</p><p>To deploy the <code>TidbCluster</code> and <code>TidbMonitor</code> CR in the GKE cluster, run the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f tidb-cluster.yaml -n tidb-cluster </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f tidb-monitor.yaml -n tidb-cluster</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>After the yaml file above is applied to the Kubernetes cluster, TiDB Operator creates the desired TiDB cluster and its monitoring component according to the yaml file.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If you need to deploy a TiDB cluster on ARM64 machines, refer to <a href="/docusaurus-operator/deploy-cluster-on-arm64">Deploy a TiDB Cluster on ARM64 Machines</a>.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="view-the-cluster-status">View the cluster status<a class="hash-link" href="#view-the-cluster-status" title="Direct link to heading">â€‹</a></h3><p>To view the status of the starting TiDB cluster, run the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -n tidb-cluster</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>When all the Pods are in the <code>Running</code> or <code>Ready</code> state, the TiDB cluster is successfully started. For example:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">NAME                              READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb-discovery-5cb8474d89-n8cxk   1/1     Running   0          47h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb-monitor-6fbcc68669-dsjlc     3/3     Running   0          47h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb-pd-0                         1/1     Running   0          47h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb-pd-1                         1/1     Running   0          46h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb-pd-2                         1/1     Running   0          46h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb-tidb-0                       2/2     Running   0          47h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb-tidb-1                       2/2     Running   0          46h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb-tikv-0                       1/1     Running   0          47h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb-tikv-1                       1/1     Running   0          47h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tidb-tikv-2                       1/1     Running   0          47h</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="access-the-tidb-database">Access the TiDB database<a class="hash-link" href="#access-the-tidb-database" title="Direct link to heading">â€‹</a></h2><p>After you deploy a TiDB cluster, you can access the TiDB database via MySQL client.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="prepare-a-bastion-host">Prepare a bastion host<a class="hash-link" href="#prepare-a-bastion-host" title="Direct link to heading">â€‹</a></h3><p>The LoadBalancer created for your TiDB cluster is an intranet LoadBalancer. You can create a <a href="https://cloud.google.com/solutions/connecting-securely#bastion" target="_blank" rel="noopener noreferrer">bastion host</a> in the cluster VPC to access the database.</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute instances create bastion </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --machine-type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">n1-standard-4 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --image-project</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">centos-cloud </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --image-family</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">centos-7 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --zone</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">${your-region}</span><span class="token plain">-a</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p><code>${your-region}-a</code> is the <code>a</code> zone in the region of the cluster, such as <code>us-central1-a</code>. You can also create the bastion host in other zones in the same region.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="install-the-mysql-client-and-connect">Install the MySQL client and connect<a class="hash-link" href="#install-the-mysql-client-and-connect" title="Direct link to heading">â€‹</a></h3><p>After the bastion host is created, you can connect to the bastion host via SSH and access the TiDB cluster via the MySQL client.</p><ol><li><p>Connect to the bastion host via SSH:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud compute </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> tidb@bastion</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Install the MySQL client:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> mysql -y</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Connect the client to the TiDB cluster:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">mysql -h </span><span class="token variable" style="color:#36acaa">${tidb-nlb-dnsname}</span><span class="token plain"> -P </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"> -u root</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>${tidb-nlb-dnsname}</code> is the LoadBalancer IP of the TiDB service. You can view the IP in the <code>EXTERNAL-IP</code> field of the <code>kubectl get svc basic-tidb -n tidb-cluster</code> execution result.</p><p>For example:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ mysql -h </span><span class="token number" style="color:#36acaa">10.128</span><span class="token plain">.15.243 -P </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"> -u root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to the MariaDB monitor.  Commands end with </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> or </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">g.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your MySQL connection </span><span class="token function" style="color:#d73a49">id</span><span class="token plain"> is </span><span class="token number" style="color:#36acaa">7823</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Server version: </span><span class="token number" style="color:#36acaa">5.7</span><span class="token plain">.25-TiDB-v4.0.4 TiDB Server </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Apache License </span><span class="token number" style="color:#36acaa">2.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> Community Edition, MySQL </span><span class="token number" style="color:#36acaa">5.7</span><span class="token plain"> compatible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Copyright </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token plain">, </span><span class="token number" style="color:#36acaa">2018</span><span class="token plain">, Oracle, MariaDB Corporation Ab and others.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type </span><span class="token string" style="color:#e3116c">&#x27;help;&#x27;</span><span class="token plain"> or </span><span class="token string" style="color:#e3116c">&#x27;\h&#x27;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> help. Type </span><span class="token string" style="color:#e3116c">&#x27;\c&#x27;</span><span class="token plain"> to </span><span class="token function" style="color:#d73a49">clear</span><span class="token plain"> the current input statement.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MySQL </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">none</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> show status</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+--------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Variable_name      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Value                                </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+--------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Ssl_cipher         </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">                                      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Ssl_cipher_list    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">                                      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Ssl_verify_mode    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">                                    </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> Ssl_version        </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">                                      </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> ddl_schema_version </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">22</span><span class="token plain">                                   </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> server_id          </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> 717420dc-0eeb-4d4a-951d-0d393aff295a </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------------+--------------------------------------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">6</span><span class="token plain"> rows </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"> sec</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li><a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_default_authentication_plugin" target="_blank" rel="noopener noreferrer">The default authentication plugin of MySQL 8.0</a> is updated from <code>mysql_native_password</code> to <code>caching_sha2_password</code>. Therefore, if you use MySQL client from MySQL 8.0 to access the TiDB service (TiDB version &lt; v4.0.7), and if the user account has a password, you need to explicitly specify the <code>--default-auth=mysql_native_password</code> parameter.</li><li>By default, TiDB (starting from v4.0.2) periodically shares usage details with PingCAP to help understand how to improve the product. For details about what is shared and how to disable the sharing, see <a href="https://docs.pingcap.com/tidb/stable/telemetry" target="_blank" rel="noopener noreferrer">Telemetry</a>.</li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="access-the-grafana-monitoring-dashboard">Access the Grafana monitoring dashboard<a class="hash-link" href="#access-the-grafana-monitoring-dashboard" title="Direct link to heading">â€‹</a></h3><p>Obtain the LoadBalancer IP of Grafana:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n tidb-cluster get svc basic-grafana</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For example:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n tidb-cluster get svc basic-grafana</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                     TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)               AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">basic-grafana            LoadBalancer   10.15.255.169   34.123.168.114   3000:30657/TCP        35m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In the output above, the <code>EXTERNAL-IP</code> column is the LoadBalancer IP.</p><p>You can access the <code>${grafana-lb}:3000</code> address using your web browser to view monitoring metrics. Replace <code>${grafana-lb}</code> with the LoadBalancer IP.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The default Grafana username and password are both <code>admin</code>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="upgrade">Upgrade<a class="hash-link" href="#upgrade" title="Direct link to heading">â€‹</a></h2><p>To upgrade the TiDB cluster, execute the following command:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl patch tc basic -n tidb-cluster --type merge -p &#x27;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;spec&quot;</span><span class="token plain">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;version&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token string variable" style="color:#36acaa">${version}</span><span class="token string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">`.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The upgrade process does not finish immediately. You can watch the upgrade progress by executing <code>kubectl get pods -n tidb-cluster --watch</code>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="scale-out">Scale out<a class="hash-link" href="#scale-out" title="Direct link to heading">â€‹</a></h2><p>Before scaling out the cluster, you need to scale out the corresponding node pool so that the new instances have enough resources for operation.</p><p>This section describes how to scale out the EKS node group and TiDB components.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="scale-out-gke-node-group">Scale out GKE node group<a class="hash-link" href="#scale-out-gke-node-group" title="Direct link to heading">â€‹</a></h3><p>The following example shows how to scale out the <code>tikv</code> node pool of the <code>tidb</code> cluster to 6 nodes:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container clusters resize tidb --node-pool tikv --num-nodes </span><span class="token number" style="color:#36acaa">2</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>In the regional cluster, the nodes are created in 3 zones. Therefore, after scaling out, the number of nodes is <code>2 * 3 = 6</code>.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="scale-out-tidb-components">Scale out TiDB components<a class="hash-link" href="#scale-out-tidb-components" title="Direct link to heading">â€‹</a></h3><p>After that, execute <code>kubectl edit tc basic -n tidb-cluster</code> and modify each component&#x27;s <code>replicas</code> to the desired number of replicas. The scaling-out process is then completed.</p><p>For more information on managing node pools, refer to <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/node-pools" target="_blank" rel="noopener noreferrer">GKE Node pools</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="deploy-tiflash-and-ticdc">Deploy TiFlash and TiCDC<a class="hash-link" href="#deploy-tiflash-and-ticdc" title="Direct link to heading">â€‹</a></h2><p><a href="https://docs.pingcap.com/tidb/stable/tiflash-overview" target="_blank" rel="noopener noreferrer">TiFlash</a> is the columnar storage extension of TiKV.</p><p><a href="https://docs.pingcap.com/tidb/stable/ticdc-overview" target="_blank" rel="noopener noreferrer">TiCDC</a> is a tool for replicating the incremental data of TiDB by pulling TiKV change logs.</p><p>The two components are <em>not required</em> in the deployment. This section shows a quick start example.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="create-new-node-pools">Create new node pools<a class="hash-link" href="#create-new-node-pools" title="Direct link to heading">â€‹</a></h3><ul><li><p>Create a node pool for TiFlash:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools create tiflash --cluster tidb --machine-type n1-highmem-8 --num-nodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-labels </span><span class="token assign-left variable" style="color:#36acaa">dedicated</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tiflash --node-taints </span><span class="token assign-left variable" style="color:#36acaa">dedicated</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tiflash:NoSchedule</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Create a node pool for TiCDC:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools create ticdc --cluster tidb --machine-type n1-standard-4 --num-nodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --node-labels </span><span class="token assign-left variable" style="color:#36acaa">dedicated</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ticdc --node-taints </span><span class="token assign-left variable" style="color:#36acaa">dedicated</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">ticdc:NoSchedule</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="configure-and-deploy">Configure and deploy<a class="hash-link" href="#configure-and-deploy" title="Direct link to heading">â€‹</a></h3><ul><li><p>To deploy TiFlash, configure <code>spec.tiflash</code> in <code>tidb-cluster.yaml</code>. For example:</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tiflash</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">baseImage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pingcap/tiflash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxFailoverCount</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storageClaims</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nodeSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">dedicated</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tiflash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tolerations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">effect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dedicated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Equal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tiflash</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>  To configure other parameters, refer to <a href="/docusaurus-operator/configure-a-tidb-cluster">Configure a TiDB Cluster</a>.</p><blockquote><p><strong>Warning:</strong></p><p>TiDB Operator automatically mounts PVs <strong>in the order of the configuration</strong> in the <code>storageClaims</code> list. Therefore, if you need to add disks for TiFlash, make sure that you add the disks <strong>only to the end of the original configuration</strong> in the list. In addition, you must <strong>not</strong> alter the order of the original configuration.</p></blockquote></li><li><p>To deploy TiCDC, configure <code>spec.ticdc</code> in <code>tidb-cluster.yaml</code>. For example:</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ticdc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">baseImage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pingcap/ticdc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nodeSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">dedicated</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ticdc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tolerations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">effect</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dedicated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">operator</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Equal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ticdc</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>  Modify <code>replicas</code> according to your needs.</p></li></ul><p>Finally, execute <code>kubectl -n tidb-cluster apply -f tidb-cluster.yaml</code> to update the TiDB cluster configuration.</p><p>For detailed CR configuration, refer to <a href="https://github.com/pingcap/tidb-operator/blob/master/docs/api-references/docs.md" target="_blank" rel="noopener noreferrer">API references</a> and <a href="/docusaurus-operator/configure-a-tidb-cluster">Configure a TiDB Cluster</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="deploy-tidb-enterprise-edition">Deploy TiDB Enterprise Edition<a class="hash-link" href="#deploy-tidb-enterprise-edition" title="Direct link to heading">â€‹</a></h2><p>To deploy TiDB/PD/TiKV/TiFlash/TiCDC Enterprise Edition, configure <code>spec.[tidb|pd|tikv|tiflash|ticdc].baseImage</code> in <code>tidb-cluster.yaml</code> as the enterprise image. The enterprise image format is <code>pingcap/[tidb|pd|tikv|tiflash|ticdc]-enterprise</code>.</p><p>For example:</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">baseImage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pingcap/pd</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">enterprise</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tikv</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">baseImage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pingcap/tikv</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">enterprise</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="use-local-storage">Use local storage<a class="hash-link" href="#use-local-storage" title="Direct link to heading">â€‹</a></h2><p>Use <a href="https://cloud.google.com/compute/docs/disks#pdspecs" target="_blank" rel="noopener noreferrer">Zonal Persistent disks</a> as a primary production configuration. To simulate bare metal performance, some GCP instance types provide additional <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/persistent-volumes/local-ssd" target="_blank" rel="noopener noreferrer">local store volumes</a>. You can choose such instances for the TiKV node pool to achieve higher IOPS and lower latency.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>You cannot dynamically change the storage class of a running TiDB cluster. You can create a new cluster for testing.</p><p>During the GKE upgrade, <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/persistent-volumes/local-ssd" target="_blank" rel="noopener noreferrer">data in the local storage will be lost</a> due to the node reconstruction. When the node reconstruction occurs, you need to migrate data in TiKV. If you do not want to migrate data, it is recommended not to use the local disk in the production environment.</p></div></div><ol><li><p>Create a node pool with local storage for TiKV:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud container node-pools create tikv --cluster tidb --machine-type n1-standard-4 --num-nodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> --local-ssd-count </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --node-labels </span><span class="token assign-left variable" style="color:#36acaa">dedicated</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tikv --node-taints </span><span class="token assign-left variable" style="color:#36acaa">dedicated</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tikv:NoSchedule</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If the TiKV node pool already exists, you can either delete the old pool and then create a new one, or change the pool name to avoid conflict.</p></li><li><p>Deploy the local volume provisioner.</p><p>You need to use the <a href="https://sigs.k8s.io/sig-storage-local-static-provisioner" target="_blank" rel="noopener noreferrer">local-volume-provisioner</a> to discover and manage the local storage. Executing the following command deploys and creates a <code>local-storage</code> storage class:</p><div class="codeBlockContainer_I0IT language-shell theme-code-block"><div class="codeBlockContent_wNvx shell"><pre tabindex="0" class="prism-code language-shell codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f https://raw.githubusercontent.com/pingcap/tidb-operator/master/manifests/gke/local-ssd-provision/local-ssd-provision.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>Use the local storage.</p><p>After the steps above, the local volume provisioner can discover all the local NVMe SSD disks in the cluster.</p><p>Modify <code>tikv.storageClassName</code> in the <code>tidb-cluster.yaml</code> file to <code>local-storage</code>.</p></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/deploy-on-gcp-gke.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docusaurus-operator/deploy-on-aws-eks"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Deploy TiDB on AWS EKS</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docusaurus-operator/deploy-on-azure-aks"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deploy TiDB on Azure AKS</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#configure-the-gcp-service" class="table-of-contents__link toc-highlight">Configure the GCP service</a></li><li><a href="#create-a-gke-cluster-and-node-pool" class="table-of-contents__link toc-highlight">Create a GKE cluster and node pool</a></li><li><a href="#deploy-tidb-operator" class="table-of-contents__link toc-highlight">Deploy TiDB Operator</a></li><li><a href="#deploy-a-tidb-cluster-and-the-monitoring-component" class="table-of-contents__link toc-highlight">Deploy a TiDB cluster and the monitoring component</a><ul><li><a href="#create-namespace" class="table-of-contents__link toc-highlight">Create namespace</a></li><li><a href="#deploy" class="table-of-contents__link toc-highlight">Deploy</a></li><li><a href="#view-the-cluster-status" class="table-of-contents__link toc-highlight">View the cluster status</a></li></ul></li><li><a href="#access-the-tidb-database" class="table-of-contents__link toc-highlight">Access the TiDB database</a><ul><li><a href="#prepare-a-bastion-host" class="table-of-contents__link toc-highlight">Prepare a bastion host</a></li><li><a href="#install-the-mysql-client-and-connect" class="table-of-contents__link toc-highlight">Install the MySQL client and connect</a></li><li><a href="#access-the-grafana-monitoring-dashboard" class="table-of-contents__link toc-highlight">Access the Grafana monitoring dashboard</a></li></ul></li><li><a href="#upgrade" class="table-of-contents__link toc-highlight">Upgrade</a></li><li><a href="#scale-out" class="table-of-contents__link toc-highlight">Scale out</a><ul><li><a href="#scale-out-gke-node-group" class="table-of-contents__link toc-highlight">Scale out GKE node group</a></li><li><a href="#scale-out-tidb-components" class="table-of-contents__link toc-highlight">Scale out TiDB components</a></li></ul></li><li><a href="#deploy-tiflash-and-ticdc" class="table-of-contents__link toc-highlight">Deploy TiFlash and TiCDC</a><ul><li><a href="#create-new-node-pools" class="table-of-contents__link toc-highlight">Create new node pools</a></li><li><a href="#configure-and-deploy" class="table-of-contents__link toc-highlight">Configure and deploy</a></li></ul></li><li><a href="#deploy-tidb-enterprise-edition" class="table-of-contents__link toc-highlight">Deploy TiDB Enterprise Edition</a></li><li><a href="#use-local-storage" class="table-of-contents__link toc-highlight">Use local storage</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docusaurus-operator/">User Manual</a></li><li class="footer__item"><a class="footer__link-item" href="/docusaurus-operator/architecture">Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/tidb" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://tidb.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>tidb.io<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/pingcap" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/pingcap/tidb-operator" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Source Code<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 TiDB in Kubernetes Docs, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/docusaurus-operator/assets/js/runtime~main.7b6c7d1a.js"></script>
<script src="/docusaurus-operator/assets/js/main.81ad91ac.js"></script>
</body>
</html>